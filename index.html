
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.9">
    
    
      
        <title>S3-Management-Tool</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ferramenta-de-gerenciamento-do-amazon-s3" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="S3-Management-Tool" class="md-header__button md-logo" aria-label="S3-Management-Tool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            S3-Management-Tool
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Roteiro
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/niveaabreu/S3-Management-Tool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    niveaabreu/S3-Management-Tool
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="S3-Management-Tool" class="md-nav__button md-logo" aria-label="S3-Management-Tool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    S3-Management-Tool
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/niveaabreu/S3-Management-Tool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    niveaabreu/S3-Management-Tool
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Roteiro
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Roteiro
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisitos" class="md-nav__link">
    Pré requisitos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursos-essenciais-da-ferramenta" class="md-nav__link">
    Recursos essenciais da ferramenta
  </a>
  
    <nav class="md-nav" aria-label="Recursos essenciais da ferramenta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws" class="md-nav__link">
    AWS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s3" class="md-nav__link">
    S3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bucket" class="md-nav__link">
    Bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform" class="md-nav__link">
    Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s3-events" class="md-nav__link">
    S3 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funcao-aws-lambda" class="md-nav__link">
    Função AWS Lambda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amazon-simple-notification-service-sns" class="md-nav__link">
    Amazon Simple Notification Service (SNS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudwatch-alarm" class="md-nav__link">
    CloudWatch Alarm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciando-nossa-infraestrutura" class="md-nav__link">
    Iniciando nossa infraestrutura
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#como-subir-um-site-estatico-por-terraform" class="md-nav__link">
    Como subir um site estático por Terraform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3-events-engatilhando-uma-funcao-lambda" class="md-nav__link">
    S3 events engatilhando uma função Lambda
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-um-topico-de-notificacoes-no-sns" class="md-nav__link">
    Criando um tópico de notificações no SNS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-um-alarme-no-cloudwatch" class="md-nav__link">
    Criando um alarme no Cloudwatch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-mais-um-bucket-e-passando-nomes-como-variaveis" class="md-nav__link">
    Criando mais um Bucket e passando nomes como variáveis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-uma-interface-para-gerenciar-uploads-e-downloads-nos-buckets" class="md-nav__link">
    Criando uma interface para gerenciar Uploads e Downloads nos Buckets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisitos" class="md-nav__link">
    Pré requisitos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursos-essenciais-da-ferramenta" class="md-nav__link">
    Recursos essenciais da ferramenta
  </a>
  
    <nav class="md-nav" aria-label="Recursos essenciais da ferramenta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws" class="md-nav__link">
    AWS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s3" class="md-nav__link">
    S3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bucket" class="md-nav__link">
    Bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform" class="md-nav__link">
    Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s3-events" class="md-nav__link">
    S3 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funcao-aws-lambda" class="md-nav__link">
    Função AWS Lambda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amazon-simple-notification-service-sns" class="md-nav__link">
    Amazon Simple Notification Service (SNS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudwatch-alarm" class="md-nav__link">
    CloudWatch Alarm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciando-nossa-infraestrutura" class="md-nav__link">
    Iniciando nossa infraestrutura
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#como-subir-um-site-estatico-por-terraform" class="md-nav__link">
    Como subir um site estático por Terraform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3-events-engatilhando-uma-funcao-lambda" class="md-nav__link">
    S3 events engatilhando uma função Lambda
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-um-topico-de-notificacoes-no-sns" class="md-nav__link">
    Criando um tópico de notificações no SNS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-um-alarme-no-cloudwatch" class="md-nav__link">
    Criando um alarme no Cloudwatch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-mais-um-bucket-e-passando-nomes-como-variaveis" class="md-nav__link">
    Criando mais um Bucket e passando nomes como variáveis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-uma-interface-para-gerenciar-uploads-e-downloads-nos-buckets" class="md-nav__link">
    Criando uma interface para gerenciar Uploads e Downloads nos Buckets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="ferramenta-de-gerenciamento-do-amazon-s3">Ferramenta de Gerenciamento do Amazon S3</h1>
<p>Esta é uma ferramenta/produto de gerenciamento de buckets S3, instancias de armazenamento, com templates terraform tipo como se fosse um "google drive". </p>
<div align="center">
<img  style="width:500px" src="./assets/management.png"/>
</div>

<p>Com esta ferramenta, será  possível criar-se novos buckets no S3, gerenciar suas permissões de acesso, criação de folders, criação de políticas. Será possível também a listagem de buckets na conta do usuários, objetos em um bucket especificado, configurações de lifecycle. </p>
<p>Por fim, pretende-se a criação de uma simples interface web que possibilite o upload de objetos no bucket, assim como listagem,  download e exclusão destes caso seja do desejo do usuário. Notificação para saber qual bucket foi modificado.</p>
<p>Você pode conferir a plataforma (devidamente testada) que iremos construir segundo o vídeo abaixo:</p>
<div align="center" class="video-wrapper">
<iframe width="560" height="315" src="https://www.youtube.com/embed/KghZ8fsLV9M" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div>

<h2 id="pre-requisitos">Pré requisitos</h2>
<p>Para execução adequada deste roteiro, são necessários os seguintes pré-requisitos:</p>
<ul>
<li>Ubuntu &gt; 20.0 ou WSL2</li>
<li>Terraform</li>
<li>Python &gt; 3.6</li>
<li>Conta na AWS com usuário com permissões de administrador</li>
</ul>
<h2 id="recursos-essenciais-da-ferramenta">Recursos essenciais da ferramenta</h2>
<p>Queremos, ao fim desse roteiro, provisionar uma arquitetura como a abaixo:</p>
<div align="center">
<img  style="width:500px" src="./assets/arq.png"/>
</div>

<p>Que será capaz de criar um sistema de armazenamento de arquivos e até site estático, com funcionalidade de gerar notificações ao dono desses recursos para cada objeto adicionado nos buckets, criando assim além de grande disponibilidade e facilidade de uso, uma arquitetura altamente rastreável, permitindo a verificação mais rápido de erros e brechas de segurança.</p>
<h3 id="aws">AWS</h3>
<p>É uma plataforma de serviços de computação em nuvem oferecida pela Amazon, que permite que indivíduos e organizações implementem aplicativos, serviços e infraestrutura na nuvem. A AWS oferece uma ampla variedade de serviços em nuvem, incluindo computação, armazentamento, banco de dados, análise, inteligência artificial, machine learning e muito mais.</p>
<p>Para conseguir interagir com os serviços e funções que a AWS provém, por meio de IaC (Infrastructure as Code), é necessário obter <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html">chaves de acesso</a>, que permitam o gerenciamento e provisionamento dos recursos que desejamos alocar na nuvem.</p>
<p>De posse de suas respectivas chaves de acesso, crie duas variáveis de ambiente, conforme padrão abaixo:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>&lt;ID_CHAVE_DE_ACESSO&gt;
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>&lt;CHAVE_SECRETA_DE_ACESSO&gt;
</span></code></pre></div>
Realiza-se o acesso a essas chaves para segurança de dados de quem acessa, pois assim evita-se sempre ter que colocar a senha no ambiente e a senha estar exposta</p>
<h3 id="s3">S3</h3>
<p>É um serviço de armanezamento de objetos oferecido pela Amazon Web Services (AWS). O S3 permite que os usuários armazenem e recuperem arquivos de qualquer lugar da web.
O S3 é amplamente utilizado por empresas e organizações de diferentes setores para armazenamento e compartilhamento de arquivos, backup e arquivamento de dados, hospedagem de sites e aplicativos, e muito mais.</p>
<h3 id="bucket">Bucket</h3>
<p>Bucket é um conceito de armazenamento usado em serviços de armazenamento em nuvem, como o Amazon S3. Um bucket pode ser considerado como um contêiner de objetos, que pode armazenar e gerenciar vários objetos, como arquivos, imagens, vídeos, entre outros. Os buckets são amplamente utilizados para hospedar sites estáticos, armazenamento de backup, arquivamento de dados e muito mais. Eles são uma parte essencial de muitos serviços em nuvem e permitem que os usuários armazenem, gerenciem e acessem dados de qualquer lugar da web.</p>
<h3 id="terraform">Terraform</h3>
<p>É uma infraestrutura que descreve os recursos que você deseja provisionar, como servidores, banco de dados e outros. Além disso, você pode usar o Terraform para criar, alterar e destruir recursos automaticamente.</p>
<h3 id="s3-events">S3 Events</h3>
<p>O Amazon S3 Events permite que você monitore alterações em seu bucket do Amazon S3 e responda essas alterações executando ações automáticas. Quando um evento ocorre em seu bucket como upload de um arquivo ou a exclusão de um objeto o S3 Events pode acusar uma ação automática como a invocação de uma função AWS Lambda ou a notificação de um tópico do Amazon Simple Notificacion Service (SNS).</p>
<h3 id="funcao-aws-lambda">Função AWS Lambda</h3>
<p>As Funções AWS Lambda fazem o processamento de eventos em tempo real como logs e notificações. Por exemplo, você pode criar uma função lambda que é acionada sempre que um novo objeto é enviado para um bucket do Amazon S3. A função pode processar o objeto, extrair informações relevantes, executar transformações ou armazenar dados em outros serviço. </p>
<h3 id="amazon-simple-notification-service-sns">Amazon Simple Notification Service (SNS)</h3>
<p>O SNS é um serviço de mensagens e notificação da AWS que permite enviar mensagens para diferentes tipos de endpoints como emails, mensagens de texto(SMS), URLs entre outros. Além disso, você pode configurar o acesso para quem pode publicar e para quem pode se inscrever no tópico.</p>
<h3 id="cloudwatch-alarm">CloudWatch Alarm</h3>
<p>O CloudWatch Alarm é um serviço de monitoramento e observabilidade da AWS. O CloudWatch Alarm permite monitorar métricas específicas e acionar ações automáticas com base em condições predefinidas.</p>
<h2 id="iniciando-nossa-infraestrutura">Iniciando nossa infraestrutura</h2>
<p>Crie uma pasta para organizar nossos arquivos chamada <strong>terraform/</strong>::</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>mkdir<span class="w"> </span>terraform<span class="w"> </span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>terraform
</span></code></pre></div>
<p>Como nosso primeiro objetivo é criar um bucket na AWS crie um template chamado <strong>s3.tf</strong> com o seguinte conteúdo:</p>
<div class="language-terraform highlight"><span class="filename">s3.tf</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">#Provider and default region used</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="na">region</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-2&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="p">}</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;exemplo&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&lt;Nome do bucket&gt;&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;My bucket&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dev&quot;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="p">}</span>
</span></code></pre></div>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /> <strong>Subistitua o nome do bucket pelo que você deseja, lembrando que esse nome é único em toda AWS</strong></p>
<p>Inicie então os recursos terraform necessários para provisionar rodando o comando abaixo:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>terraform<span class="w"> </span>init
</span></code></pre></div>
<p>Agora veremos o plano de criação desses recursos:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>terraform<span class="w"> </span>plan
</span></code></pre></div>
<p>Por fim, realize deploy deste recurso na nuvem:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>terraform<span class="w"> </span>apply<span class="w"> </span>-auto-approve
</span></code></pre></div>
<p>Caso tudo dê certo você verá isso no console da AWS</p>
<div align="center">
<img  style="width:500px" src="./assets/bucket-nivea.png"/>
</div>

<h2 id="como-subir-um-site-estatico-por-terraform">Como subir um site estático por Terraform</h2>
<p>Agora que já conseguimos subir um bucket privado de uso geral, podemos também modificar nossa infraestrutura para provisionar buckets que disponibilizem páginas estáticas, conforme nosso plano de infraestrutura.
Para isso, devemos...</p>
<ul>
<li>Fazer um provedor de nuvem da AWS</li>
<li>Especificar o recurso que se quer criar : um bucket</li>
<li>Define-se os controles do bucket</li>
<li>Definir os acesso publico pra tirar esse bloqueio do </li>
<li>Definir qual o acesso do bucket</li>
<li>Definir uma nova configuração de bucket</li>
<li>Política de acesso a leitura do bucket</li>
<li>Configurações e buckets de indexar pagina </li>
</ul>
<p>Para isso, crie um novo arquivo chamado s3_website, que irá realizar os passos acima:</p>
<div class="language-terraform highlight"><span class="filename">s3_website.tf</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span><span class="c1"> # Substitua pela região desejada</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">}</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bucketdanivinhaprojeto21&quot;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">}</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_ownership_controls&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="na">object_ownership</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;BucketOwnerPreferred&quot;</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="p">}</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_public_access_block&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">  </span><span class="na">block_public_acls</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">  </span><span class="na">block_public_policy</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">  </span><span class="na">ignore_public_acls</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">  </span><span class="na">restrict_public_buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="p">}</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_acl&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">    </span><span class="nv">aws_s3_bucket_ownership_controls.example</span><span class="p">,</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">    </span><span class="nv">aws_s3_bucket_public_access_block.example</span><span class="p">,</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">  </span><span class="na">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;public-read&quot;</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="p">}</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_versioning&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="p">}</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_caller_identity&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_policy&quot;</span><span class="w"> </span><span class="nv">&quot;public_read_access&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_iam_policy_document.public_read_access.json</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="p">}</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy_document&quot;</span><span class="w"> </span><span class="nv">&quot;public_read_access&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">  </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="w">    </span><span class="nb">principals</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="w">      </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">      </span><span class="na">identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="w">    </span><span class="na">actions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="w">      </span><span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="w">      </span><span class="s2">&quot;s3:ListBucket&quot;</span><span class="p">,</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="w">    </span><span class="na">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="w">      </span><span class="nv">aws_s3_bucket.website.arn</span><span class="p">,</span>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="w">      </span><span class="s2">&quot;${aws_s3_bucket.website.arn}/*&quot;</span><span class="p">,</span>
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="p">}</span>
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_website_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.bucket</span>
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="p">}</span>
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;index_page&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span>
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a><span class="p">}</span><span class="w"> </span>
</span></code></pre></div>
<p>Na mesma pasta crie um arquivo chamado <strong>index.html</strong> e coloque o seguinte conteúdo nele:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello World<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>Inicie então os recursos terraform necessários para provisionar rodando o comando abaixo:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>terraform<span class="w"> </span>init
</span></code></pre></div>
<p>Agora veremos o plano de criação desses recursos:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>terraform<span class="w"> </span>plan
</span></code></pre></div>
<p>Por fim, realize deploy deste recurso na nuvem:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>terraform<span class="w"> </span>apply<span class="w"> </span>-auto-approve
</span></code></pre></div>
<p>Caso tudo dê certo você verá isso no console da AWS</p>
<div align="center">
<img  style="width:500px" src="./assets/index2.png"/>
</div>

<p>E a pagina você verá isso</p>
<div align="center">
<img  style="width:500px" src="./assets/index3.png"/>
</div>

<p>Fica disponibilizado o link em que você pode verificar:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>http://bucketdanivinhaprojeto21.s3-website-us-east-1.amazonaws.com
</span></code></pre></div>
<h2 id="s3-events-engatilhando-uma-funcao-lambda">S3 events engatilhando uma função Lambda</h2>
<p>Já conseguimos criar diferentes buckets que contemplam sua função: </p>
<p><strong>Armazenar objetos</strong></p>
<p>Para se adequar a nossa arquitetura desejada, devemos então integrar o <em>S3 events</em>, um notificador de eventos próprio do Amazon S3 para engatilhar uma função Lambda a cada vez que um novo objeto for adicionado neste bucket.</p>
<p>Para isso, precisamos então:</p>
<ul>
<li>Configurar S3 events nos buckets que já possuímos;</li>
<li>Criar um template que provisiona uma função Lambda que será engatilhada por esse evento</li>
<li>Criar permissões que autorizem o S3 events a engatilhar a função.</li>
</ul>
<p>Para isso, iremos utilizar módulos do terraform, para melhorar a organização de nossos templates e também facilitar a conexão entre esses templates, conforme será necessário.</p>
<p>Crie três pastas, chamadas respectivamente <strong>lambda</strong>, <strong>s3</strong> e <strong>s3_website</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>mkdir<span class="w"> </span>lambda
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>mkdir<span class="w"> </span>s3
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>mkdir<span class="w"> </span>s3_website
</span></code></pre></div>
<p>Mova o arquivo <strong>s3.tf</strong> para a pasta <strong>s3/</strong>, <strong>s3_website.tf</strong> para <strong>s3_website/</strong> e crie um arquivo <strong>lambda.tf</strong> para a pasta <strong>lambda/</strong>. Não coloque nada nesse arquivo ainda.</p>
<p>Modifique o arquivo <strong>s3.tf</strong>, adicionando os componentes de permissão para a execução da Lambda e notificação do S3.</p>
<div class="language-terraform highlight"><span class="filename">s3.tf</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="p">}</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="p">}</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;exemplo&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bucket-nivea-456864&quot;</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;My bucket&quot;</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dev&quot;</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="p">}</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;exemplo&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;example-statement-id&quot;</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nv">var.function_name</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="w"> </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3.amazonaws.com&quot;</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="w">  </span><span class="na">source_arn</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.exemplo.arn}/&quot;</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="p">}</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3_notification&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-aws-modules/s3-bucket/aws//modules/notification&quot;</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="w">  </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 3.0&quot;</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.exemplo.id</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="w">  </span><span class="na">eventbridge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="w">  </span><span class="nb">lambda_notifications</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="w">    </span><span class="nb">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="w">      </span><span class="na">function_arn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_arn</span>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a><span class="w">      </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_name</span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="w">      </span><span class="na">events</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;s3:ObjectCreated:*&quot;</span><span class="p">]</span>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="p">}</span>
</span></code></pre></div>
<p>Dentro da pasta <strong>lambda/</strong>, crie um arquivo chamado <strong>events.py</strong>, com o seguinte conteúdo:</p>
<div class="language-python highlight"><span class="filename">events.py</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">import</span> <span class="nn">json</span> 
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Novo objeto adicionado&quot;</span><span class="p">)</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s1">&#39;Hello from Lambda!&#39;</span><span class="p">)</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="p">}</span>
</span></code></pre></div>
<p>Compacte  função usando seu compactador preferido (Winrar, Zip e etc), para criar um arquivo chamado <strong>events.zip</strong> que contenha o arquivo <strong>events.py</strong>.</p>
<p>Crie então o arquivo <strong>lambda.tf</strong> na atual pasta, que irá criar:</p>
<ul>
<li>A função propriamente dita, com sua linguagem de programação, nome e outras configurações;</li>
<li>Role com permissões necessárias;</li>
<li>Políticas de permissões necessárias;</li>
<li>Output para passar detalhes da função para o template do S3.</li>
</ul>
<p>Assim crie:</p>
<div class="language-terraform highlight"><span class="filename">lambda.tf</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;events&quot;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="na">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;python3.8&quot;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="na">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;events.lambda_handler&quot;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda.arn</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">  </span><span class="na">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda/events.zip&quot;</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">      </span><span class="na">EXAMPLE_VARIABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;example_value&quot;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="p">}</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;a1s3-events-execution-lambda&quot;</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda.amazonaws.com&quot;</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="p">}</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole&quot;</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda.name</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="p">}</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.example.function_name</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="p">}</span>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.example.arn</span>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="p">}</span>
</span></code></pre></div>
<p>Retorne para o diretório <strong>terraform/</strong>:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">cd</span><span class="w"> </span>..
</span></code></pre></div></p>
<p>Crie um arquivo <strong>main.tf</strong>, que irá reunir e referenciar os módulos agora criados:</p>
<ul>
<li>Módulo Lambda e seus outputs(nome e ARN);</li>
<li>Módulo S3;</li>
<li>Módulo S3-Website</li>
</ul>
<div class="language-terraform highlight"><span class="filename">main.tf</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="na">region</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="p">}</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./lambda&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="p">}</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="p">}</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="p">}</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3&quot;</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">  </span><span class="na">function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="p">}</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3_website&quot;</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="p">}</span>
</span></code></pre></div>
<p>Dessa forma sua organização de diretório deve ficar assim:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>terraform/
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>  |
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>  ------main.tf
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>  |
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>  ------lambda/
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>      |
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>      ------lambda.tf
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>  |
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>  ------s3/
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>      |
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>      ------s3.tf
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>  |
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>  ------s3_website/
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>      |
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>      ------s3_website.tf
</span></code></pre></div>
<p>Rode em seu terminal para iniciar novamente o backend:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>terraform init
</span></code></pre></div>
<p>Veja se o acoplamento lógico dos componentes está correto:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>terraform plan
</span></code></pre></div>
<p>Aplique as mudanças:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>terraform apply -auto-approve
</span></code></pre></div>
Estando tudo correto, você deverá em seu console, além dos buckets anteriormente criados, a seguinte função:</p>
<div align="center">
<img  style="width:500px" src="./assets/lambda.png"/>
</div>

<h2 id="criando-um-topico-de-notificacoes-no-sns">Criando um tópico de notificações no SNS</h2>
<p>Até então conseguimos provisionar um bucket e uma função Lambda engatilhada a cada novo objeto adicionado neste bucket. 
Precisamos então, criar uma notificação que avise algum dos desenvolvedores ou dono da infraestrutura, que um novo objeto foi adicionado, gerando assim, maior controle da infraestrutura e suas mudanças.</p>
<p>Dessa forma, iremos utilizar o SNS, que conforme explicado no começo deste roteiro, tem por seu fim, enviar notificações para diferentes meios, como <strong>email, SMS, HTTP e outros</strong>. Para este projeto, iremos configurar um tópico SNS que irá enviar uma solicitação par um email cadastrado.</p>
<p>Dessa forma, crie uma pasta chamada <strong>SNS/</strong> dentro do diretório <strong>terraform/</strong>, e adicione o arquivo <strong>sns.tf</strong>.</p>
<p>Este irá conter:</p>
<ul>
<li>O nome do tópico a ser criado;</li>
<li>O protocolo de envio do tópico (email) e a endpoit de envio (seu endereço de email);</li>
<li>E um output do ARN do recurso criado para uso posterior.</li>
</ul>
<p>Assim, coloque no arquivo <strong>sns.tf</strong>:</p>
<div class="language-terraform highlight"><span class="filename">sns.tf</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_sns_topic&quot;</span><span class="w"> </span><span class="nv">&quot;example_topic&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;example-topic&quot;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="p">}</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;email_subscription&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;teste@al.insper.edu.br&quot;</span><span class="c1"> # Insira seu email</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="p">}</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_sns_topic_subscription&quot;</span><span class="w"> </span><span class="nv">&quot;email_subscription&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">  </span><span class="na">topic_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_sns_topic.example_topic.arn</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">  </span><span class="na">protocol</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;email&quot;</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">  </span><span class="na">endpoint</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.email_subscription</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="p">}</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;sns_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_sns_topic.example_topic.arn</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>Dessa forma sua organização de diretório deve ficar assim:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>terraform/
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>  |
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>  ------main.tf
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>  |
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>  ------lambda/
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>      |
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>      ------lambda.tf
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>  |
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>  ------sns/
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>      |
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>      ------sns.tf
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>  |
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>  ------s3/
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>      |
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>      ------s3.tf
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>  |
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>  ------s3_website/
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>      |
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>      ------s3_website.tf
</span></code></pre></div>
<p>Retorne para o diretório <strong>terraform/</strong> e adeque seu arquivo <strong>main.tf</strong> para conter o módulo <strong>sns/</strong>:</p>
<div class="language-terraform highlight"><span class="filename">main.tf</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="na">region</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="p">}</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./lambda&quot;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="p">}</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="p">}</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="p">}</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3&quot;</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">  </span><span class="na">function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="p">}</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3_website&quot;</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="p">}</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;sns&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./sns&quot;</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="p">}</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;sns_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.sns.sns_arn</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="p">}</span>
</span></code></pre></div>
<p>Rode em seu terminal para iniciar novamente o backend:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>terraform init
</span></code></pre></div>
<p>Veja se o acoplamento lógico dos componentes está correto:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>terraform plan
</span></code></pre></div>
<p>Aplique as mudanças:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>terraform apply -auto-approve
</span></code></pre></div>
Estando tudo correto, você deverá em seu console, o tópico criado:</p>
<div align="center">
<img  style="width:500px" src="./assets/sns.png"/>
</div>

<h2 id="criando-um-alarme-no-cloudwatch">Criando um alarme no Cloudwatch</h2>
<p>Já conseguimos então ter uma função Lambda que é engatilhada a cada novo objeto colocado em um bucket e um tópico no SNS que consegue gerar notificações de email para o usuário cadastrado.</p>
<p>Precisamos então criar um componente que irá ser o conector entre estes, isto é, a cada vez que uma função Lambda for engatilhada, gerar uma notificação para o usuário via SNS.</p>
<p>Para isso, podemos criar um alarme no Cloudwatch que irá monitorar os logs padrões gerados pela Lambda, e com isso, gera uma notificação no tópico.</p>
<p>Dessa forma, devemos criar um alarme que:</p>
<ul>
<li>Receberá o ARN do tópico que irá gerar a notificação;</li>
<li>Irá filtrar nos logs da função Lambda desejada (aqui por padrão chamada de <strong>events</strong>);</li>
<li>Criar um alarme no Cloudwatch que irá transicionar do estado <strong>OK</strong> para <strong>ALARM</strong> a cada novo log irá tomar a ação de criar uma notificação no tópico que o ARN for passado ao template.</li>
</ul>
<p>Crie um arquivo chamado <strong>cloudwatch.tf</strong> em uma pasta chamada <strong>cloudwatch/</strong> dentro do diretório <strong>terraform/</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>mkdir cloudwatch
</span></code></pre></div>
<p>Coloque o arquivo da seguinte maneira:</p>
<p><div class="language-terraform highlight"><span class="filename">cloudwatch.tf</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;sns_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="p">}</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_log_metric_filter&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_log_filter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="na">name</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda-log-filter&quot;</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">  </span><span class="na">pattern</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;{ $.eventType = Error }&quot;</span><span class="c1"> # Substitua pelo padrão que você deseja monitorar</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">  </span><span class="na">log_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/aws/lambda/events&quot;</span><span class="c1">      # Substitua pelo nome do grupo de log correto</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">  </span><span class="nb">metric_transformation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ErrorCount&quot;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">    </span><span class="na">namespace</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Custom/CloudWatchLogs&quot;</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">    </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">    </span><span class="na">default_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="p">}</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_log_alarm&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda-log-alarm&quot;</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Alarm triggered on CloudWatch Logs&quot;</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanOrEqualToThreshold&quot;</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ErrorCount&quot;</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Custom/CloudWatchLogs&quot;</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;60&quot;</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SampleCount&quot;</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">  </span><span class="na">alarm_actions</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">var.sns_arn</span><span class="p">]</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="w">  </span><span class="na">treat_missing_data</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;missing&quot;</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="p">}</span>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_log_metric_filter&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_log_filter_subscription&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="w">  </span><span class="na">name</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda-log-filter-subscription&quot;</span>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a><span class="w">  </span><span class="na">pattern</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;{ $.eventType = Error }&quot;</span><span class="c1"> # Substitua pelo padrão que você deseja monitorar</span>
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="w">  </span><span class="na">log_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/aws/lambda/events&quot;</span><span class="c1">      # Substitua pelo nome do grupo de log correto</span>
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a>
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="w">  </span><span class="nb">metric_transformation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="w">    </span><span class="na">name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ErrorCountSubscription&quot;</span>
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="w">    </span><span class="na">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Custom/CloudWatchLogs&quot;</span>
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="w">    </span><span class="na">value</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-42"><a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a><span class="p">}</span>
</span></code></pre></div>
Dessa forma sua organização de diretório deve ficar assim:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>terraform/
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>  |
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>  ------main.tf
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>  |
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>  ------lambda/
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>      |
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>      ------lambda.tf
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>  |
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>  ------sns/
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>      |
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>      ------sns.tf
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>  |
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>  ------s3/
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>      |
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>      ------s3.tf
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>  |
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>  ------s3_website/
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>      |
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>      ------s3_website.tf
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>  |
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>  ------cloudwatch/
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>    |
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>    ------cloudwatch.tf
</span></code></pre></div>
<p>Modifique o arquivo <strong>main.tf</strong>, para adequar o módulo recém criado:</p>
<p>Veja que passamos o ARN do tópico do SNS criado como uma variável para o Cloudwatch Alarme.</p>
<div class="language-terraform highlight"><span class="filename">main.tf</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="na">region</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="p">}</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./lambda&quot;</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="p">}</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="p">}</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="p">}</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3&quot;</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="w">  </span><span class="na">function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="p">}</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3_website&quot;</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="p">}</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;sns&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./sns&quot;</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="p">}</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;sns_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.sns.sns_arn</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a><span class="p">}</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;cloudwatch&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./cloudwatch&quot;</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a><span class="w">  </span><span class="na">sns_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.sns.sns_arn</span>
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a><span class="p">}</span>
</span></code></pre></div>
<p>Rode em seu terminal para iniciar novamente o backend:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>terraform init
</span></code></pre></div>
<p>Veja se o acoplamento lógico dos componentes está correto:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>terraform plan
</span></code></pre></div>
<p>Aplique as mudanças:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>terraform apply -auto-approve
</span></code></pre></div>
Estando tudo correto, você deverá em seu console, o alarme do Cloudwatch criado:</p>
<div align="center">
<img  style="width:500px" src="./assets/alarm.png"/>
</div>

<p>Veja em seu email cadastrado que você deve ter recebido uma notificação:</p>
<div align="center">
<img  style="width:500px" src="./assets/confirm.png"/>
</div>

<p>Para testar o funcionamento da arquitetura, adicione um objeto qualquer ao Bucket S3 recém criado. Depois de alguns minutos você deverá receber um email como o abaixo, indicando que o Alarme do CloudWatch Alarme foi acionado e um novo objeto foi adicionado no bucket.</p>
<p>Cloudwatch notificando alarme:</p>
<div align="center">
<img  style="width:500px" src="./assets/cloudwatch.png"/>
</div>

<p>Email de notificação:</p>
<div align="center">
<img  style="width:500px" src="./assets/notif.png"/>
</div>

<h2 id="criando-mais-um-bucket-e-passando-nomes-como-variaveis">Criando mais um Bucket e passando nomes como variáveis</h2>
<p>Apesar de já conseguirmos ter um Bucket padrão que engatilha notificações em um email previamente cadastrado e um bucket próprio para hosteamento de sites estáticos, nossa arquitetura desejada prevê a criação de um outro bucket para simular a divisão entre buckets.</p>
<p>Além disso, seria ideal que conseguimos, no momento da criação (<em>terraform apply</em>), os nomes dos buckets e o email de destino para notificações, facilitando assim o controle de erros (advindos do nome único de buckets) e mudança de valores desejados (ao invés de ter que modificar o template propriamente).</p>
<div align="center">
<img  style="width:500px" src="./assets/arq.png"/>
</div>

<p>Assim, devemos:</p>
<ul>
<li>Criar um outro bucket (genericamente destinado a fotos, mas pode ser utilizado para outros fins do usuário);</li>
<li>Generalizar o nome dos buckets e do email cadastrado (permitindo estes serem passados como variáveis no momento de deploy da arquitetura);</li>
</ul>
<p>Para isso, primeiramente, crie uma pasta dentro de <strong>terraform/</strong> chamada (genericamente), de <em>s3_fotos</em>. Nesta pasta, crie um arquivo chamado <strong>s3_fotos.tf</strong>, onde iremos:</p>
<ul>
<li>Criar um bucket genericamente para fotos;</li>
<li>Criar um evento de S3 events para este;</li>
<li>Criar variáveis que permitam a passagem de nomes (nome do bucket e valores da função Lambda associada) durante criação (ou usar defaults);</li>
</ul>
<p>Assim, crie o arquivo da seguinte forma:</p>
<div class="language-terraform highlight"><span class="filename">s3_fotos.tf</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="p">}</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="p">}</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;fotos_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ProjetoBucket132&quot;</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="p">}</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;exemplo_fotos&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.fotos_name</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;PUT&quot;, &quot;POST&quot;, &quot;DELETE&quot;</span><span class="p">]</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;My bucket&quot;</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dev&quot;</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="p">}</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;exemplo_fotos&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;fotos-statement-id&quot;</span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nv">var.function_name</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="w"> </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3.amazonaws.com&quot;</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a><span class="w">  </span><span class="na">source_arn</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.exemplo_fotos.arn}/&quot;</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a><span class="p">}</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3_notification&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-38"><a id="__codelineno-35-38" name="__codelineno-35-38" href="#__codelineno-35-38"></a><span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-aws-modules/s3-bucket/aws//modules/notification&quot;</span>
</span><span id="__span-35-39"><a id="__codelineno-35-39" name="__codelineno-35-39" href="#__codelineno-35-39"></a><span class="w">  </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 3.0&quot;</span>
</span><span id="__span-35-40"><a id="__codelineno-35-40" name="__codelineno-35-40" href="#__codelineno-35-40"></a>
</span><span id="__span-35-41"><a id="__codelineno-35-41" name="__codelineno-35-41" href="#__codelineno-35-41"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.exemplo_fotos.id</span>
</span><span id="__span-35-42"><a id="__codelineno-35-42" name="__codelineno-35-42" href="#__codelineno-35-42"></a><span class="w">  </span><span class="na">eventbridge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-35-43"><a id="__codelineno-35-43" name="__codelineno-35-43" href="#__codelineno-35-43"></a>
</span><span id="__span-35-44"><a id="__codelineno-35-44" name="__codelineno-35-44" href="#__codelineno-35-44"></a><span class="w">  </span><span class="nb">lambda_notifications</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-45"><a id="__codelineno-35-45" name="__codelineno-35-45" href="#__codelineno-35-45"></a><span class="w">    </span><span class="nb">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-46"><a id="__codelineno-35-46" name="__codelineno-35-46" href="#__codelineno-35-46"></a><span class="w">      </span><span class="na">function_arn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_arn</span>
</span><span id="__span-35-47"><a id="__codelineno-35-47" name="__codelineno-35-47" href="#__codelineno-35-47"></a><span class="w">      </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_name</span>
</span><span id="__span-35-48"><a id="__codelineno-35-48" name="__codelineno-35-48" href="#__codelineno-35-48"></a><span class="w">      </span><span class="na">events</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;s3:ObjectCreated:*&quot;</span><span class="p">]</span>
</span><span id="__span-35-49"><a id="__codelineno-35-49" name="__codelineno-35-49" href="#__codelineno-35-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-35-50"><a id="__codelineno-35-50" name="__codelineno-35-50" href="#__codelineno-35-50"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-51"><a id="__codelineno-35-51" name="__codelineno-35-51" href="#__codelineno-35-51"></a><span class="p">}</span>
</span></code></pre></div>
<p>Dessa forma, nosso diretório ficará com a seguinte estrutura:
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>terraform/
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>  |
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>  ------main.tf
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>  |
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>  ------lambda/
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>      |
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>      ------lambda.tf
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>  |
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>  ------sns/
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>      |
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>      ------sns.tf
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>  |
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>  ------s3_fotos/
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>      |
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>      ------s3_fotos.tf
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>  |
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>  ------s3/
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>      |
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>      ------s3.tf
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>  |
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>  ------s3_website/
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>      |
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>      ------s3_website.tf
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>  |
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a>  ------cloudwatch/
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a>    |
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a>    ------cloudwatch.tf
</span></code></pre></div></p>
<p>Devemos agora então, modificar em sequência:</p>
<ul>
<li>Adicionar um evento de S3 events para o bucket de Website;</li>
<li>Criar variáveis da função Lambda e nome do website no bucket de hosteamento;</li>
<li>Criar variável de nome do bucket para o Bucket principal;</li>
<li>Criar variáveis de nomes para os buckets e e de email e referenciar nos respectivos módulo no arquivo <strong>main.tf</strong>;</li>
</ul>
<p>Assim, altere e/ou adicione seu arquivo <strong>s3_website</strong> as seguintes linhas (adicionando as duas primeiras mudanças citadas acima):</p>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/26a0.svg" title=":warning:" /> Veja que o arquivo abaixo está incompleto para diminuir espaço, não o copie apenas, e sim substitua/adicione as partes aqui ilustradas</p>
<p><div class="language-terraform highlight"><span class="filename">s3_website.tf</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="p">}</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="p">}</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;website_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ProjetoBucket131&quot;</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="p">}</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_name</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">    </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;PUT&quot;, &quot;POST&quot;, &quot;DELETE&quot;</span><span class="p">]</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a><span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a><span class="p">}</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="hll"><span class="p">...</span>
</span></span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;website-statement-id&quot;</span>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nv">var.function_name</span>
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a><span class="w"> </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3.amazonaws.com&quot;</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a><span class="w">  </span><span class="na">source_arn</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.website.arn}/&quot;</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a><span class="p">}</span>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3_notification&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a><span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-aws-modules/s3-bucket/aws//modules/notification&quot;</span>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a><span class="w">  </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 3.0&quot;</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a>
</span><span id="__span-37-37"><a id="__codelineno-37-37" name="__codelineno-37-37" href="#__codelineno-37-37"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-37-38"><a id="__codelineno-37-38" name="__codelineno-37-38" href="#__codelineno-37-38"></a><span class="w">  </span><span class="na">eventbridge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-37-39"><a id="__codelineno-37-39" name="__codelineno-37-39" href="#__codelineno-37-39"></a>
</span><span id="__span-37-40"><a id="__codelineno-37-40" name="__codelineno-37-40" href="#__codelineno-37-40"></a><span class="w">  </span><span class="nb">lambda_notifications</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-41"><a id="__codelineno-37-41" name="__codelineno-37-41" href="#__codelineno-37-41"></a><span class="w">    </span><span class="nb">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-42"><a id="__codelineno-37-42" name="__codelineno-37-42" href="#__codelineno-37-42"></a><span class="w">      </span><span class="na">function_arn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_arn</span>
</span><span id="__span-37-43"><a id="__codelineno-37-43" name="__codelineno-37-43" href="#__codelineno-37-43"></a><span class="w">      </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_name</span>
</span><span id="__span-37-44"><a id="__codelineno-37-44" name="__codelineno-37-44" href="#__codelineno-37-44"></a><span class="w">      </span><span class="na">events</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;s3:ObjectCreated:*&quot;</span><span class="p">]</span>
</span><span id="__span-37-45"><a id="__codelineno-37-45" name="__codelineno-37-45" href="#__codelineno-37-45"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-46"><a id="__codelineno-37-46" name="__codelineno-37-46" href="#__codelineno-37-46"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-37-47"><a id="__codelineno-37-47" name="__codelineno-37-47" href="#__codelineno-37-47"></a><span class="p">}</span>
</span></code></pre></div>
Posteriormente, no arquivo <strong>s3_bucket.tf</strong>, adicione referências para a variável de nome do bucket:</p>
<div class="language-terraform highlight"><span class="filename">s3.tf</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="p">}</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="p">}</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ProjetoBucket130&quot;</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="p">}</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;exemplo&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.bucket_name</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">  </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">  </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;PUT&quot;, &quot;POST&quot;, &quot;DELETE&quot;</span><span class="p">]</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">  </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;My bucket&quot;</span>
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dev&quot;</span>
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a><span class="p">}</span>
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a>
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;exemplo&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-30"><a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;documentos-statement-id&quot;</span>
</span><span id="__span-38-31"><a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-38-32"><a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nv">var.function_name</span>
</span><span id="__span-38-33"><a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a><span class="w">  </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3.amazonaws.com&quot;</span>
</span><span id="__span-38-34"><a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a><span class="w">  </span><span class="na">source_arn</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.exemplo.arn}/&quot;</span>
</span><span id="__span-38-35"><a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a><span class="p">}</span>
</span><span id="__span-38-36"><a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a>
</span><span id="__span-38-37"><a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3_notification&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-38"><a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a><span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-aws-modules/s3-bucket/aws//modules/notification&quot;</span>
</span><span id="__span-38-39"><a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a><span class="w">  </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 3.0&quot;</span>
</span><span id="__span-38-40"><a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.exemplo.id</span>
</span><span id="__span-38-41"><a id="__codelineno-38-41" name="__codelineno-38-41" href="#__codelineno-38-41"></a><span class="w">  </span><span class="na">eventbridge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-38-42"><a id="__codelineno-38-42" name="__codelineno-38-42" href="#__codelineno-38-42"></a>
</span><span id="__span-38-43"><a id="__codelineno-38-43" name="__codelineno-38-43" href="#__codelineno-38-43"></a><span class="w">  </span><span class="nb">lambda_notifications</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-44"><a id="__codelineno-38-44" name="__codelineno-38-44" href="#__codelineno-38-44"></a><span class="w">    </span><span class="nb">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-45"><a id="__codelineno-38-45" name="__codelineno-38-45" href="#__codelineno-38-45"></a><span class="w">      </span><span class="na">function_arn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_arn</span>
</span><span id="__span-38-46"><a id="__codelineno-38-46" name="__codelineno-38-46" href="#__codelineno-38-46"></a><span class="w">      </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.function_name</span>
</span><span id="__span-38-47"><a id="__codelineno-38-47" name="__codelineno-38-47" href="#__codelineno-38-47"></a><span class="w">      </span><span class="na">events</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;s3:ObjectCreated:*&quot;</span><span class="p">]</span>
</span><span id="__span-38-48"><a id="__codelineno-38-48" name="__codelineno-38-48" href="#__codelineno-38-48"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-38-49"><a id="__codelineno-38-49" name="__codelineno-38-49" href="#__codelineno-38-49"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-38-50"><a id="__codelineno-38-50" name="__codelineno-38-50" href="#__codelineno-38-50"></a><span class="p">}</span>
</span></code></pre></div>
<p>Por fim, no arquivo <strong>main.tf</strong>, crie as variáveis necessárias, e as repasse para seus respectivos módulos, conforme arquivo abaixo:</p>
<div class="language-terraform highlight"><span class="filename">main.tf</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="na">region</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="p">}</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./lambda&quot;</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="p">}</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="p">}</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;function_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="p">}</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3&quot;</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">  </span><span class="na">bucket_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.bucket_name</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">  </span><span class="na">function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="p">}</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;fotos&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3_fotos&quot;</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">  </span><span class="na">fotos_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.fotos_name</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">  </span><span class="na">function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="p">}</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./s3_website&quot;</span>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="w">  </span><span class="na">website_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_name</span>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_name</span>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a><span class="w">  </span><span class="na">function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.lambda.function_arn</span>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="p">}</span>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;sns&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./sns&quot;</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a><span class="w">  </span><span class="na">email_subscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.email</span>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="p">}</span>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a>
</span><span id="__span-39-43"><a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;sns_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-44"><a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a><span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.sns.sns_arn</span>
</span><span id="__span-39-45"><a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a><span class="p">}</span>
</span><span id="__span-39-46"><a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a>
</span><span id="__span-39-47"><a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;cloudwatch&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-48"><a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./cloudwatch&quot;</span>
</span><span id="__span-39-49"><a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a><span class="w">  </span><span class="na">sns_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.sns.sns_arn</span>
</span><span id="__span-39-50"><a id="__codelineno-39-50" name="__codelineno-39-50" href="#__codelineno-39-50"></a><span class="p">}</span>
</span><span id="__span-39-51"><a id="__codelineno-39-51" name="__codelineno-39-51" href="#__codelineno-39-51"></a>
</span><span id="__span-39-52"><a id="__codelineno-39-52" name="__codelineno-39-52" href="#__codelineno-39-52"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-53"><a id="__codelineno-39-53" name="__codelineno-39-53" href="#__codelineno-39-53"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-39-54"><a id="__codelineno-39-54" name="__codelineno-39-54" href="#__codelineno-39-54"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ProjetoBucket130&quot;</span>
</span><span id="__span-39-55"><a id="__codelineno-39-55" name="__codelineno-39-55" href="#__codelineno-39-55"></a><span class="p">}</span>
</span><span id="__span-39-56"><a id="__codelineno-39-56" name="__codelineno-39-56" href="#__codelineno-39-56"></a>
</span><span id="__span-39-57"><a id="__codelineno-39-57" name="__codelineno-39-57" href="#__codelineno-39-57"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;website_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-58"><a id="__codelineno-39-58" name="__codelineno-39-58" href="#__codelineno-39-58"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-39-59"><a id="__codelineno-39-59" name="__codelineno-39-59" href="#__codelineno-39-59"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ProjetoBucket131&quot;</span>
</span><span id="__span-39-60"><a id="__codelineno-39-60" name="__codelineno-39-60" href="#__codelineno-39-60"></a><span class="p">}</span>
</span><span id="__span-39-61"><a id="__codelineno-39-61" name="__codelineno-39-61" href="#__codelineno-39-61"></a>
</span><span id="__span-39-62"><a id="__codelineno-39-62" name="__codelineno-39-62" href="#__codelineno-39-62"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;fotos_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-63"><a id="__codelineno-39-63" name="__codelineno-39-63" href="#__codelineno-39-63"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-39-64"><a id="__codelineno-39-64" name="__codelineno-39-64" href="#__codelineno-39-64"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ProjetoBucket132&quot;</span>
</span><span id="__span-39-65"><a id="__codelineno-39-65" name="__codelineno-39-65" href="#__codelineno-39-65"></a><span class="p">}</span>
</span><span id="__span-39-66"><a id="__codelineno-39-66" name="__codelineno-39-66" href="#__codelineno-39-66"></a>
</span><span id="__span-39-67"><a id="__codelineno-39-67" name="__codelineno-39-67" href="#__codelineno-39-67"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;email&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-68"><a id="__codelineno-39-68" name="__codelineno-39-68" href="#__codelineno-39-68"></a><span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-39-69"><a id="__codelineno-39-69" name="__codelineno-39-69" href="#__codelineno-39-69"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;niveaadl@al.insper.edu.br&quot;</span>
</span><span id="__span-39-70"><a id="__codelineno-39-70" name="__codelineno-39-70" href="#__codelineno-39-70"></a><span class="p">}</span>
</span></code></pre></div>
<p>Caso tudo esteja corretamente, configurado, inicie novamente seu ambiente para carregamento de módulos:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>terraform<span class="w"> </span>init
</span></code></pre></div>
<p>Verifique se o acoplamento lógico dos recursos é coerente (principalmente com as variáveis passadas) para resolução de problemas:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>terraform<span class="w"> </span>plan
</span></code></pre></div>
<p>Caso tudo esteja certo, execute o comando de deploy modificando as variáveis para os nomes e email desejados.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>terraform<span class="w"> </span>apply<span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;email=niveaadl@al.insper.edu&quot;</span><span class="w"> </span><span class="se">\ </span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">                </span>-var<span class="o">=</span><span class="s2">&quot;fotos_name=bucketfotos3211&quot;</span><span class="w">   </span><span class="se">\</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">                </span>-var<span class="o">=</span><span class="s2">&quot;website_name=bucketwebsite3211&quot;</span><span class="se">\ </span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">                </span>-var<span class="o">=</span><span class="s2">&quot;bucket_name=bucketname3211&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">                </span>-auto-approve
</span></code></pre></div></p>
<p>Ao fim da execução, você deverá ter em seu console a criação de:</p>
<ul>
<li>3 buckets;</li>
<li>Função Lambda;</li>
<li>Tópico SNS;</li>
<li>Alarme do Cloudwatch;</li>
<li>Permissão de execução dos recursos;</li>
</ul>
<div align="center">
<img  style="width:500px" src="./assets/buckets.png"/>
</div>

<p>Finalizando nossa arquitetura desejada na nuvem.</p>
<div align="center">
<img  style="width:500px" src="./assets/final.gif"/>
</div>

<h2 id="criando-uma-interface-para-gerenciar-uploads-e-downloads-nos-buckets">Criando uma interface para gerenciar Uploads e Downloads nos Buckets</h2>
<p>Apesar de já conseguirmos criar nossa arquitetura funcional em Cloud, é um pouco "massante" ter que abrir o dashboard para tarefas simples e rotineiras como incluir arquivos e fazer download de outros.</p>
<p>Analogamente, seria interessante criar uma estrutura de usuários nessa interface que limita-se as permissões de cada usuário, isto é, cada user pode apenas ver seus próprios arquivos.</p>
<p>Para isso iremos:</p>
<ul>
<li>Criar uma interface em React para facilitar o gerenciamento de buckets e noção de usuários;</li>
<li>Utilizar SDK da AWS para interagir com os buckets recém criados;</li>
</ul>
<p>Para isso, inicialmente instale o Node 18&gt;:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>curl<span class="w"> </span>-sL<span class="w"> </span>https://deb.nodesource.com/setup_18.x<span class="w"> </span>-o<span class="w"> </span>nodesource_setup.sh
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>sudo<span class="w"> </span>bash<span class="w"> </span>nodesource_setup.sh
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nodejs
</span></code></pre></div>
<p>Volte para o diretório raiz do projeto e crie um app React:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>npx<span class="w"> </span>create-react-app<span class="w"> </span>interface
</span></code></pre></div>
<p>Configure o npm para utilizarmos recursos de SDK da AWS com React.js:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>npm<span class="w"> </span>install<span class="w"> </span>aws-sdk
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>npm<span class="w"> </span>install<span class="w">  </span>env-cmd
</span></code></pre></div>
Após a instalação, entre na pasta <strong>src</strong> do diretório e crie um arquivo <strong>.env</strong> com as suas credenciais para utilização na SDK da AWS:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="nb">cd</span><span class="w"> </span>interface/src
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>nano<span class="w"> </span>.env
</span></code></pre></div>
<p>Coloque o seguinte conteúdo no arquivo:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>REACT_APP_AWS_ACCESS_KEY_ID=&lt;access_key_id&gt;
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>REACT_APP_AWS_SECRET_ACCESS_KEY=&lt;secret_key&gt;
</span></code></pre></div>
<p>No arquivo <strong>package.json</strong>, adicione a referência ao modulo env-cmd para permitir a utilização das variavéis de ambiente:</p>
<div class="language-json highlight"><span class="filename">package.json</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="err">...</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w"> </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="hll"><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;env-cmd -f ./.env react-scripts start&quot;</span><span class="p">,</span>
</span></span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;react-scripts build&quot;</span><span class="p">,</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;react-scripts test&quot;</span><span class="p">,</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">    </span><span class="nt">&quot;eject&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;react-scripts eject&quot;</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="err">...</span>
</span></code></pre></div>
<p>Com isso, coloque no arquivo <strong>App.js</strong>, o conteúdo de nossa aplicação, onde iremos gerenciar login de usuários e realizar solicitações diretamente ao <strong>Amazon S3</strong>:</p>
<details class="app_js">
<summary>App_js</summary>
<div class="language-javascript highlight"><span class="filename">App.js</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="k">import</span><span class="w"> </span><span class="nx">AWS</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;aws-sdk&#39;</span><span class="p">;</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="k">import</span><span class="w"> </span><span class="s1">&#39;./App.css&#39;</span><span class="p">;</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="c1">// Configuração das credenciais da AWS</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="nx">AWS</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">  </span><span class="nx">accessKeyId</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_AWS_ACCESS_KEY_ID</span><span class="p">,</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">  </span><span class="nx">secretAccessKey</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_AWS_SECRET_ACCESS_KEY</span><span class="p">,</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="p">});</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="kd">const</span><span class="w"> </span><span class="nx">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AWS</span><span class="p">.</span><span class="nx">S3</span><span class="p">();</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">bucketName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;nome_bucket&gt;&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Nome do bucket S3</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="kd">const</span><span class="w"> </span><span class="nx">bucketfotosName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;nome_bucket_fotos&gt;&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Nome do bucket S3</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">websiteName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;nome_bucket_website&gt;&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Nome do bucket S3</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="kd">const</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">selectedFile</span><span class="p">,</span><span class="w"> </span><span class="nx">setSelectedFile</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">objects</span><span class="p">,</span><span class="w"> </span><span class="nx">setObjects</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">fotos</span><span class="p">,</span><span class="w"> </span><span class="nx">setFotos</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">siteObjetcs</span><span class="p">,</span><span class="w"> </span><span class="nx">setSiteObjetcs</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">showModal</span><span class="p">,</span><span class="w"> </span><span class="nx">setShowModal</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">setUser</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">userName</span><span class="p">,</span><span class="w"> </span><span class="nx">setUserName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a><span class="c1">// ============REFRESH itens no bucket a cada novo upload</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">refreshItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a><span class="w">    </span><span class="nx">handleListObjects</span><span class="p">();</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a><span class="w">    </span><span class="nx">handleListObjectsFotos</span><span class="p">();</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a><span class="w">    </span><span class="nx">handleListObjectsWebsite</span><span class="p">();</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a><span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a><span class="w">    </span><span class="nx">refreshItems</span><span class="p">();</span>
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">selectedFile</span><span class="p">]);</span>
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a><span class="c1">// ============Gerencia credenciais do usuário no browser</span>
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a><span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">VerifyLoggin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a><span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">cred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getCredentials</span><span class="p">();</span>
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cred</span><span class="p">);</span>
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cred</span><span class="p">.</span><span class="nx">username</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
</span><span id="__span-49-41"><a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a><span class="w">        </span><span class="nx">setShowModal</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-49-42"><a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-49-43"><a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a><span class="w">      </span><span class="k">else</span><span class="p">{</span>
</span><span id="__span-49-44"><a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a><span class="w">        </span><span class="nx">setShowModal</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span><span id="__span-49-45"><a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a><span class="w">        </span><span class="nx">setUserName</span><span class="p">(</span><span class="nx">cred</span><span class="p">.</span><span class="nx">username</span><span class="p">);</span>
</span><span id="__span-49-46"><a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-49-47"><a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-48"><a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a><span class="w">    </span><span class="nx">VerifyLoggin</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-49"><a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</span><span id="__span-49-50"><a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a>
</span><span id="__span-49-51"><a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">logout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-52"><a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a><span class="w">    </span><span class="nx">setUser</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span id="__span-49-53"><a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a><span class="w">    </span><span class="nx">saveCredentials</span><span class="p">();</span>
</span><span id="__span-49-54"><a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a><span class="w">    </span><span class="nx">setShowModal</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-49-55"><a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-56"><a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a>
</span><span id="__span-49-57"><a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-49-58"><a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a>
</span><span id="__span-49-59"><a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">saveCredentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-60"><a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="p">;</span>
</span><span id="__span-49-61"><a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">){</span>
</span><span id="__span-49-62"><a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a><span class="w">      </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-49-63"><a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-64"><a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">credentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-65"><a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a><span class="w">      </span><span class="nx">username</span>
</span><span id="__span-49-66"><a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-67"><a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a><span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;credentials&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">credentials</span><span class="p">));</span>
</span><span id="__span-49-68"><a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-69"><a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a>
</span><span id="__span-49-70"><a id="__codelineno-49-70" name="__codelineno-49-70" href="#__codelineno-49-70"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getCredentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-71"><a id="__codelineno-49-71" name="__codelineno-49-71" href="#__codelineno-49-71"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">credentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;credentials&#39;</span><span class="p">);</span>
</span><span id="__span-49-72"><a id="__codelineno-49-72" name="__codelineno-49-72" href="#__codelineno-49-72"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">credentials</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-73"><a id="__codelineno-49-73" name="__codelineno-49-73" href="#__codelineno-49-73"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">credentials</span><span class="p">);</span>
</span><span id="__span-49-74"><a id="__codelineno-49-74" name="__codelineno-49-74" href="#__codelineno-49-74"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-75"><a id="__codelineno-49-75" name="__codelineno-49-75" href="#__codelineno-49-75"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-49-76"><a id="__codelineno-49-76" name="__codelineno-49-76" href="#__codelineno-49-76"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-77"><a id="__codelineno-49-77" name="__codelineno-49-77" href="#__codelineno-49-77"></a>
</span><span id="__span-49-78"><a id="__codelineno-49-78" name="__codelineno-49-78" href="#__codelineno-49-78"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleModal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-79"><a id="__codelineno-49-79" name="__codelineno-49-79" href="#__codelineno-49-79"></a><span class="w">    </span><span class="nx">setShowModal</span><span class="p">(</span><span class="o">!</span><span class="nx">showModal</span><span class="p">);</span>
</span><span id="__span-49-80"><a id="__codelineno-49-80" name="__codelineno-49-80" href="#__codelineno-49-80"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-81"><a id="__codelineno-49-81" name="__codelineno-49-81" href="#__codelineno-49-81"></a>
</span><span id="__span-49-82"><a id="__codelineno-49-82" name="__codelineno-49-82" href="#__codelineno-49-82"></a><span class="c1">// =================UPLOAD nos BUCKETS==================</span>
</span><span id="__span-49-83"><a id="__codelineno-49-83" name="__codelineno-49-83" href="#__codelineno-49-83"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFileUpload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-84"><a id="__codelineno-49-84" name="__codelineno-49-84" href="#__codelineno-49-84"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">selectedFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-85"><a id="__codelineno-49-85" name="__codelineno-49-85" href="#__codelineno-49-85"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Nenhum arquivo selecionado.&#39;</span><span class="p">);</span>
</span><span id="__span-49-86"><a id="__codelineno-49-86" name="__codelineno-49-86" href="#__codelineno-49-86"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-49-87"><a id="__codelineno-49-87" name="__codelineno-49-87" href="#__codelineno-49-87"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-88"><a id="__codelineno-49-88" name="__codelineno-49-88" href="#__codelineno-49-88"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectedFile</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span id="__span-49-89"><a id="__codelineno-49-89" name="__codelineno-49-89" href="#__codelineno-49-89"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">uploadParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-90"><a id="__codelineno-49-90" name="__codelineno-49-90" href="#__codelineno-49-90"></a><span class="w">      </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">bucketName</span><span class="p">,</span>
</span><span id="__span-49-91"><a id="__codelineno-49-91" name="__codelineno-49-91" href="#__codelineno-49-91"></a><span class="w">      </span><span class="nx">Key</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">fileName</span><span class="p">,</span>
</span><span id="__span-49-92"><a id="__codelineno-49-92" name="__codelineno-49-92" href="#__codelineno-49-92"></a><span class="w">      </span><span class="nx">Body</span><span class="o">:</span><span class="w"> </span><span class="nx">selectedFile</span><span class="p">,</span>
</span><span id="__span-49-93"><a id="__codelineno-49-93" name="__codelineno-49-93" href="#__codelineno-49-93"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-94"><a id="__codelineno-49-94" name="__codelineno-49-94" href="#__codelineno-49-94"></a>
</span><span id="__span-49-95"><a id="__codelineno-49-95" name="__codelineno-49-95" href="#__codelineno-49-95"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-96"><a id="__codelineno-49-96" name="__codelineno-49-96" href="#__codelineno-49-96"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">upload</span><span class="p">(</span><span class="nx">uploadParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-97"><a id="__codelineno-49-97" name="__codelineno-49-97" href="#__codelineno-49-97"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Arquivo enviado com sucesso.&#39;</span><span class="p">);</span>
</span><span id="__span-49-98"><a id="__codelineno-49-98" name="__codelineno-49-98" href="#__codelineno-49-98"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-99"><a id="__codelineno-49-99" name="__codelineno-49-99" href="#__codelineno-49-99"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao enviar arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-100"><a id="__codelineno-49-100" name="__codelineno-49-100" href="#__codelineno-49-100"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-101"><a id="__codelineno-49-101" name="__codelineno-49-101" href="#__codelineno-49-101"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-102"><a id="__codelineno-49-102" name="__codelineno-49-102" href="#__codelineno-49-102"></a>
</span><span id="__span-49-103"><a id="__codelineno-49-103" name="__codelineno-49-103" href="#__codelineno-49-103"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFileUploadFotos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-104"><a id="__codelineno-49-104" name="__codelineno-49-104" href="#__codelineno-49-104"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">selectedFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-105"><a id="__codelineno-49-105" name="__codelineno-49-105" href="#__codelineno-49-105"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Nenhum arquivo selecionado.&#39;</span><span class="p">);</span>
</span><span id="__span-49-106"><a id="__codelineno-49-106" name="__codelineno-49-106" href="#__codelineno-49-106"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-49-107"><a id="__codelineno-49-107" name="__codelineno-49-107" href="#__codelineno-49-107"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-108"><a id="__codelineno-49-108" name="__codelineno-49-108" href="#__codelineno-49-108"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectedFile</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span id="__span-49-109"><a id="__codelineno-49-109" name="__codelineno-49-109" href="#__codelineno-49-109"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">uploadParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-110"><a id="__codelineno-49-110" name="__codelineno-49-110" href="#__codelineno-49-110"></a><span class="w">      </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">bucketfotosName</span><span class="p">,</span>
</span><span id="__span-49-111"><a id="__codelineno-49-111" name="__codelineno-49-111" href="#__codelineno-49-111"></a><span class="w">      </span><span class="nx">Key</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">fileName</span><span class="p">,</span>
</span><span id="__span-49-112"><a id="__codelineno-49-112" name="__codelineno-49-112" href="#__codelineno-49-112"></a><span class="w">      </span><span class="nx">Body</span><span class="o">:</span><span class="w"> </span><span class="nx">selectedFile</span><span class="p">,</span>
</span><span id="__span-49-113"><a id="__codelineno-49-113" name="__codelineno-49-113" href="#__codelineno-49-113"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-114"><a id="__codelineno-49-114" name="__codelineno-49-114" href="#__codelineno-49-114"></a>
</span><span id="__span-49-115"><a id="__codelineno-49-115" name="__codelineno-49-115" href="#__codelineno-49-115"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-116"><a id="__codelineno-49-116" name="__codelineno-49-116" href="#__codelineno-49-116"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">upload</span><span class="p">(</span><span class="nx">uploadParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-117"><a id="__codelineno-49-117" name="__codelineno-49-117" href="#__codelineno-49-117"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Arquivo enviado com sucesso.&#39;</span><span class="p">);</span>
</span><span id="__span-49-118"><a id="__codelineno-49-118" name="__codelineno-49-118" href="#__codelineno-49-118"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-119"><a id="__codelineno-49-119" name="__codelineno-49-119" href="#__codelineno-49-119"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao enviar arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-120"><a id="__codelineno-49-120" name="__codelineno-49-120" href="#__codelineno-49-120"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-121"><a id="__codelineno-49-121" name="__codelineno-49-121" href="#__codelineno-49-121"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-122"><a id="__codelineno-49-122" name="__codelineno-49-122" href="#__codelineno-49-122"></a>
</span><span id="__span-49-123"><a id="__codelineno-49-123" name="__codelineno-49-123" href="#__codelineno-49-123"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFileUploadWebsite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-124"><a id="__codelineno-49-124" name="__codelineno-49-124" href="#__codelineno-49-124"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">selectedFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-125"><a id="__codelineno-49-125" name="__codelineno-49-125" href="#__codelineno-49-125"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Nenhum arquivo selecionado.&#39;</span><span class="p">);</span>
</span><span id="__span-49-126"><a id="__codelineno-49-126" name="__codelineno-49-126" href="#__codelineno-49-126"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-49-127"><a id="__codelineno-49-127" name="__codelineno-49-127" href="#__codelineno-49-127"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-128"><a id="__codelineno-49-128" name="__codelineno-49-128" href="#__codelineno-49-128"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectedFile</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span id="__span-49-129"><a id="__codelineno-49-129" name="__codelineno-49-129" href="#__codelineno-49-129"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">uploadParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-130"><a id="__codelineno-49-130" name="__codelineno-49-130" href="#__codelineno-49-130"></a><span class="w">      </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">websiteName</span><span class="p">,</span>
</span><span id="__span-49-131"><a id="__codelineno-49-131" name="__codelineno-49-131" href="#__codelineno-49-131"></a><span class="w">      </span><span class="nx">Key</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">fileName</span><span class="p">,</span>
</span><span id="__span-49-132"><a id="__codelineno-49-132" name="__codelineno-49-132" href="#__codelineno-49-132"></a><span class="w">      </span><span class="nx">Body</span><span class="o">:</span><span class="w"> </span><span class="nx">selectedFile</span><span class="p">,</span>
</span><span id="__span-49-133"><a id="__codelineno-49-133" name="__codelineno-49-133" href="#__codelineno-49-133"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-134"><a id="__codelineno-49-134" name="__codelineno-49-134" href="#__codelineno-49-134"></a>
</span><span id="__span-49-135"><a id="__codelineno-49-135" name="__codelineno-49-135" href="#__codelineno-49-135"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-136"><a id="__codelineno-49-136" name="__codelineno-49-136" href="#__codelineno-49-136"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">upload</span><span class="p">(</span><span class="nx">uploadParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-137"><a id="__codelineno-49-137" name="__codelineno-49-137" href="#__codelineno-49-137"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Arquivo enviado com sucesso.&#39;</span><span class="p">);</span>
</span><span id="__span-49-138"><a id="__codelineno-49-138" name="__codelineno-49-138" href="#__codelineno-49-138"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-139"><a id="__codelineno-49-139" name="__codelineno-49-139" href="#__codelineno-49-139"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao enviar arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-140"><a id="__codelineno-49-140" name="__codelineno-49-140" href="#__codelineno-49-140"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-141"><a id="__codelineno-49-141" name="__codelineno-49-141" href="#__codelineno-49-141"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-142"><a id="__codelineno-49-142" name="__codelineno-49-142" href="#__codelineno-49-142"></a><span class="c1">// =================DOWNLOAD dos BUCKETS==================</span>
</span><span id="__span-49-143"><a id="__codelineno-49-143" name="__codelineno-49-143" href="#__codelineno-49-143"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFileDownload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">fileName</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-144"><a id="__codelineno-49-144" name="__codelineno-49-144" href="#__codelineno-49-144"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">downloadParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-145"><a id="__codelineno-49-145" name="__codelineno-49-145" href="#__codelineno-49-145"></a><span class="w">      </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">bucketName</span><span class="p">,</span>
</span><span id="__span-49-146"><a id="__codelineno-49-146" name="__codelineno-49-146" href="#__codelineno-49-146"></a><span class="w">      </span><span class="nx">Key</span><span class="o">:</span><span class="w"> </span><span class="nx">fileName</span><span class="p">,</span>
</span><span id="__span-49-147"><a id="__codelineno-49-147" name="__codelineno-49-147" href="#__codelineno-49-147"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-148"><a id="__codelineno-49-148" name="__codelineno-49-148" href="#__codelineno-49-148"></a>
</span><span id="__span-49-149"><a id="__codelineno-49-149" name="__codelineno-49-149" href="#__codelineno-49-149"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-150"><a id="__codelineno-49-150" name="__codelineno-49-150" href="#__codelineno-49-150"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">getObject</span><span class="p">(</span><span class="nx">downloadParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-151"><a id="__codelineno-49-151" name="__codelineno-49-151" href="#__codelineno-49-151"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Dados do arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-49-152"><a id="__codelineno-49-152" name="__codelineno-49-152" href="#__codelineno-49-152"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileBlob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">data</span><span class="p">.</span><span class="nx">Body</span><span class="p">]);</span>
</span><span id="__span-49-153"><a id="__codelineno-49-153" name="__codelineno-49-153" href="#__codelineno-49-153"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">fileBlob</span><span class="p">);</span>
</span><span id="__span-49-154"><a id="__codelineno-49-154" name="__codelineno-49-154" href="#__codelineno-49-154"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
</span><span id="__span-49-155"><a id="__codelineno-49-155" name="__codelineno-49-155" href="#__codelineno-49-155"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileUrl</span><span class="p">;</span>
</span><span id="__span-49-156"><a id="__codelineno-49-156" name="__codelineno-49-156" href="#__codelineno-49-156"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileName</span><span class="p">;</span>
</span><span id="__span-49-157"><a id="__codelineno-49-157" name="__codelineno-49-157" href="#__codelineno-49-157"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
</span><span id="__span-49-158"><a id="__codelineno-49-158" name="__codelineno-49-158" href="#__codelineno-49-158"></a><span class="w">      </span><span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span><span class="p">(</span><span class="nx">fileUrl</span><span class="p">);</span>
</span><span id="__span-49-159"><a id="__codelineno-49-159" name="__codelineno-49-159" href="#__codelineno-49-159"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-160"><a id="__codelineno-49-160" name="__codelineno-49-160" href="#__codelineno-49-160"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao baixar o arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-161"><a id="__codelineno-49-161" name="__codelineno-49-161" href="#__codelineno-49-161"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-162"><a id="__codelineno-49-162" name="__codelineno-49-162" href="#__codelineno-49-162"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-163"><a id="__codelineno-49-163" name="__codelineno-49-163" href="#__codelineno-49-163"></a>
</span><span id="__span-49-164"><a id="__codelineno-49-164" name="__codelineno-49-164" href="#__codelineno-49-164"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFileDownloadFotos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">fileName</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-165"><a id="__codelineno-49-165" name="__codelineno-49-165" href="#__codelineno-49-165"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">downloadParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-166"><a id="__codelineno-49-166" name="__codelineno-49-166" href="#__codelineno-49-166"></a><span class="w">      </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">bucketfotosName</span><span class="p">,</span>
</span><span id="__span-49-167"><a id="__codelineno-49-167" name="__codelineno-49-167" href="#__codelineno-49-167"></a><span class="w">      </span><span class="nx">Key</span><span class="o">:</span><span class="w"> </span><span class="nx">fileName</span><span class="p">,</span>
</span><span id="__span-49-168"><a id="__codelineno-49-168" name="__codelineno-49-168" href="#__codelineno-49-168"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-169"><a id="__codelineno-49-169" name="__codelineno-49-169" href="#__codelineno-49-169"></a>
</span><span id="__span-49-170"><a id="__codelineno-49-170" name="__codelineno-49-170" href="#__codelineno-49-170"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-171"><a id="__codelineno-49-171" name="__codelineno-49-171" href="#__codelineno-49-171"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">getObject</span><span class="p">(</span><span class="nx">downloadParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-172"><a id="__codelineno-49-172" name="__codelineno-49-172" href="#__codelineno-49-172"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Dados do arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-49-173"><a id="__codelineno-49-173" name="__codelineno-49-173" href="#__codelineno-49-173"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileBlob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">data</span><span class="p">.</span><span class="nx">Body</span><span class="p">]);</span>
</span><span id="__span-49-174"><a id="__codelineno-49-174" name="__codelineno-49-174" href="#__codelineno-49-174"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">fileBlob</span><span class="p">);</span>
</span><span id="__span-49-175"><a id="__codelineno-49-175" name="__codelineno-49-175" href="#__codelineno-49-175"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
</span><span id="__span-49-176"><a id="__codelineno-49-176" name="__codelineno-49-176" href="#__codelineno-49-176"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileUrl</span><span class="p">;</span>
</span><span id="__span-49-177"><a id="__codelineno-49-177" name="__codelineno-49-177" href="#__codelineno-49-177"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileName</span><span class="p">;</span>
</span><span id="__span-49-178"><a id="__codelineno-49-178" name="__codelineno-49-178" href="#__codelineno-49-178"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
</span><span id="__span-49-179"><a id="__codelineno-49-179" name="__codelineno-49-179" href="#__codelineno-49-179"></a><span class="w">      </span><span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span><span class="p">(</span><span class="nx">fileUrl</span><span class="p">);</span>
</span><span id="__span-49-180"><a id="__codelineno-49-180" name="__codelineno-49-180" href="#__codelineno-49-180"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-181"><a id="__codelineno-49-181" name="__codelineno-49-181" href="#__codelineno-49-181"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao baixar o arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-182"><a id="__codelineno-49-182" name="__codelineno-49-182" href="#__codelineno-49-182"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-183"><a id="__codelineno-49-183" name="__codelineno-49-183" href="#__codelineno-49-183"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-184"><a id="__codelineno-49-184" name="__codelineno-49-184" href="#__codelineno-49-184"></a>
</span><span id="__span-49-185"><a id="__codelineno-49-185" name="__codelineno-49-185" href="#__codelineno-49-185"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFileDownloadWebsite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">fileName</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-186"><a id="__codelineno-49-186" name="__codelineno-49-186" href="#__codelineno-49-186"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">downloadParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-187"><a id="__codelineno-49-187" name="__codelineno-49-187" href="#__codelineno-49-187"></a><span class="w">      </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">websiteName</span><span class="p">,</span>
</span><span id="__span-49-188"><a id="__codelineno-49-188" name="__codelineno-49-188" href="#__codelineno-49-188"></a><span class="w">      </span><span class="nx">Key</span><span class="o">:</span><span class="w"> </span><span class="nx">fileName</span><span class="p">,</span>
</span><span id="__span-49-189"><a id="__codelineno-49-189" name="__codelineno-49-189" href="#__codelineno-49-189"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-190"><a id="__codelineno-49-190" name="__codelineno-49-190" href="#__codelineno-49-190"></a>
</span><span id="__span-49-191"><a id="__codelineno-49-191" name="__codelineno-49-191" href="#__codelineno-49-191"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-192"><a id="__codelineno-49-192" name="__codelineno-49-192" href="#__codelineno-49-192"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">getObject</span><span class="p">(</span><span class="nx">downloadParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-193"><a id="__codelineno-49-193" name="__codelineno-49-193" href="#__codelineno-49-193"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Dados do arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-49-194"><a id="__codelineno-49-194" name="__codelineno-49-194" href="#__codelineno-49-194"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileBlob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">data</span><span class="p">.</span><span class="nx">Body</span><span class="p">]);</span>
</span><span id="__span-49-195"><a id="__codelineno-49-195" name="__codelineno-49-195" href="#__codelineno-49-195"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">fileBlob</span><span class="p">);</span>
</span><span id="__span-49-196"><a id="__codelineno-49-196" name="__codelineno-49-196" href="#__codelineno-49-196"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
</span><span id="__span-49-197"><a id="__codelineno-49-197" name="__codelineno-49-197" href="#__codelineno-49-197"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileUrl</span><span class="p">;</span>
</span><span id="__span-49-198"><a id="__codelineno-49-198" name="__codelineno-49-198" href="#__codelineno-49-198"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileName</span><span class="p">;</span>
</span><span id="__span-49-199"><a id="__codelineno-49-199" name="__codelineno-49-199" href="#__codelineno-49-199"></a><span class="w">      </span><span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
</span><span id="__span-49-200"><a id="__codelineno-49-200" name="__codelineno-49-200" href="#__codelineno-49-200"></a><span class="w">      </span><span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span><span class="p">(</span><span class="nx">fileUrl</span><span class="p">);</span>
</span><span id="__span-49-201"><a id="__codelineno-49-201" name="__codelineno-49-201" href="#__codelineno-49-201"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-202"><a id="__codelineno-49-202" name="__codelineno-49-202" href="#__codelineno-49-202"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao baixar o arquivo:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-203"><a id="__codelineno-49-203" name="__codelineno-49-203" href="#__codelineno-49-203"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-204"><a id="__codelineno-49-204" name="__codelineno-49-204" href="#__codelineno-49-204"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-205"><a id="__codelineno-49-205" name="__codelineno-49-205" href="#__codelineno-49-205"></a>
</span><span id="__span-49-206"><a id="__codelineno-49-206" name="__codelineno-49-206" href="#__codelineno-49-206"></a><span class="c1">// =================Listagem de objetos dos BUCKETS para o usuário==================</span>
</span><span id="__span-49-207"><a id="__codelineno-49-207" name="__codelineno-49-207" href="#__codelineno-49-207"></a><span class="kd">const</span><span class="w"> </span><span class="nx">handleListObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-208"><a id="__codelineno-49-208" name="__codelineno-49-208" href="#__codelineno-49-208"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">listParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-209"><a id="__codelineno-49-209" name="__codelineno-49-209" href="#__codelineno-49-209"></a><span class="w">    </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">bucketName</span><span class="p">,</span>
</span><span id="__span-49-210"><a id="__codelineno-49-210" name="__codelineno-49-210" href="#__codelineno-49-210"></a><span class="w">    </span><span class="nx">Prefix</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="__span-49-211"><a id="__codelineno-49-211" name="__codelineno-49-211" href="#__codelineno-49-211"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-212"><a id="__codelineno-49-212" name="__codelineno-49-212" href="#__codelineno-49-212"></a>
</span><span id="__span-49-213"><a id="__codelineno-49-213" name="__codelineno-49-213" href="#__codelineno-49-213"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-214"><a id="__codelineno-49-214" name="__codelineno-49-214" href="#__codelineno-49-214"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">listObjectsV2</span><span class="p">(</span><span class="nx">listParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-215"><a id="__codelineno-49-215" name="__codelineno-49-215" href="#__codelineno-49-215"></a><span class="w">    </span><span class="nx">setObjects</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Contents</span><span class="p">);</span>
</span><span id="__span-49-216"><a id="__codelineno-49-216" name="__codelineno-49-216" href="#__codelineno-49-216"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Objetos no bucket:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">Contents</span><span class="p">);</span>
</span><span id="__span-49-217"><a id="__codelineno-49-217" name="__codelineno-49-217" href="#__codelineno-49-217"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-218"><a id="__codelineno-49-218" name="__codelineno-49-218" href="#__codelineno-49-218"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao listar objetos:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-219"><a id="__codelineno-49-219" name="__codelineno-49-219" href="#__codelineno-49-219"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-49-220"><a id="__codelineno-49-220" name="__codelineno-49-220" href="#__codelineno-49-220"></a><span class="p">};</span>
</span><span id="__span-49-221"><a id="__codelineno-49-221" name="__codelineno-49-221" href="#__codelineno-49-221"></a>
</span><span id="__span-49-222"><a id="__codelineno-49-222" name="__codelineno-49-222" href="#__codelineno-49-222"></a><span class="kd">const</span><span class="w"> </span><span class="nx">handleListObjectsFotos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-223"><a id="__codelineno-49-223" name="__codelineno-49-223" href="#__codelineno-49-223"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">listParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-224"><a id="__codelineno-49-224" name="__codelineno-49-224" href="#__codelineno-49-224"></a><span class="w">    </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">bucketfotosName</span><span class="p">,</span>
</span><span id="__span-49-225"><a id="__codelineno-49-225" name="__codelineno-49-225" href="#__codelineno-49-225"></a><span class="w">    </span><span class="nx">Prefix</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="__span-49-226"><a id="__codelineno-49-226" name="__codelineno-49-226" href="#__codelineno-49-226"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-227"><a id="__codelineno-49-227" name="__codelineno-49-227" href="#__codelineno-49-227"></a>
</span><span id="__span-49-228"><a id="__codelineno-49-228" name="__codelineno-49-228" href="#__codelineno-49-228"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-229"><a id="__codelineno-49-229" name="__codelineno-49-229" href="#__codelineno-49-229"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">listObjectsV2</span><span class="p">(</span><span class="nx">listParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-230"><a id="__codelineno-49-230" name="__codelineno-49-230" href="#__codelineno-49-230"></a><span class="w">    </span><span class="nx">setFotos</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Contents</span><span class="p">);</span>
</span><span id="__span-49-231"><a id="__codelineno-49-231" name="__codelineno-49-231" href="#__codelineno-49-231"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Objetos no bucket:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">Contents</span><span class="p">);</span>
</span><span id="__span-49-232"><a id="__codelineno-49-232" name="__codelineno-49-232" href="#__codelineno-49-232"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-233"><a id="__codelineno-49-233" name="__codelineno-49-233" href="#__codelineno-49-233"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao listar objetos:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-234"><a id="__codelineno-49-234" name="__codelineno-49-234" href="#__codelineno-49-234"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-49-235"><a id="__codelineno-49-235" name="__codelineno-49-235" href="#__codelineno-49-235"></a><span class="p">};</span>
</span><span id="__span-49-236"><a id="__codelineno-49-236" name="__codelineno-49-236" href="#__codelineno-49-236"></a>
</span><span id="__span-49-237"><a id="__codelineno-49-237" name="__codelineno-49-237" href="#__codelineno-49-237"></a><span class="kd">const</span><span class="w"> </span><span class="nx">handleListObjectsWebsite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-238"><a id="__codelineno-49-238" name="__codelineno-49-238" href="#__codelineno-49-238"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">listParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-239"><a id="__codelineno-49-239" name="__codelineno-49-239" href="#__codelineno-49-239"></a><span class="w">    </span><span class="nx">Bucket</span><span class="o">:</span><span class="w"> </span><span class="nx">websiteName</span><span class="p">,</span>
</span><span id="__span-49-240"><a id="__codelineno-49-240" name="__codelineno-49-240" href="#__codelineno-49-240"></a><span class="w">    </span><span class="nx">Prefix</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="__span-49-241"><a id="__codelineno-49-241" name="__codelineno-49-241" href="#__codelineno-49-241"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-242"><a id="__codelineno-49-242" name="__codelineno-49-242" href="#__codelineno-49-242"></a>
</span><span id="__span-49-243"><a id="__codelineno-49-243" name="__codelineno-49-243" href="#__codelineno-49-243"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-244"><a id="__codelineno-49-244" name="__codelineno-49-244" href="#__codelineno-49-244"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">s3</span><span class="p">.</span><span class="nx">listObjectsV2</span><span class="p">(</span><span class="nx">listParams</span><span class="p">).</span><span class="nx">promise</span><span class="p">();</span>
</span><span id="__span-49-245"><a id="__codelineno-49-245" name="__codelineno-49-245" href="#__codelineno-49-245"></a><span class="w">    </span><span class="nx">setSiteObjetcs</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Contents</span><span class="p">);</span>
</span><span id="__span-49-246"><a id="__codelineno-49-246" name="__codelineno-49-246" href="#__codelineno-49-246"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Objetos no bucket:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">Contents</span><span class="p">);</span>
</span><span id="__span-49-247"><a id="__codelineno-49-247" name="__codelineno-49-247" href="#__codelineno-49-247"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-248"><a id="__codelineno-49-248" name="__codelineno-49-248" href="#__codelineno-49-248"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Erro ao listar objetos:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-49-249"><a id="__codelineno-49-249" name="__codelineno-49-249" href="#__codelineno-49-249"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-49-250"><a id="__codelineno-49-250" name="__codelineno-49-250" href="#__codelineno-49-250"></a><span class="p">};</span>
</span><span id="__span-49-251"><a id="__codelineno-49-251" name="__codelineno-49-251" href="#__codelineno-49-251"></a>
</span><span id="__span-49-252"><a id="__codelineno-49-252" name="__codelineno-49-252" href="#__codelineno-49-252"></a><span class="c1">// ============Gerenciamento de arquivo</span>
</span><span id="__span-49-253"><a id="__codelineno-49-253" name="__codelineno-49-253" href="#__codelineno-49-253"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-254"><a id="__codelineno-49-254" name="__codelineno-49-254" href="#__codelineno-49-254"></a><span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span id="__span-49-255"><a id="__codelineno-49-255" name="__codelineno-49-255" href="#__codelineno-49-255"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-256"><a id="__codelineno-49-256" name="__codelineno-49-256" href="#__codelineno-49-256"></a>
</span><span id="__span-49-257"><a id="__codelineno-49-257" name="__codelineno-49-257" href="#__codelineno-49-257"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleFileChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-258"><a id="__codelineno-49-258" name="__codelineno-49-258" href="#__codelineno-49-258"></a><span class="w">    </span><span class="nx">setSelectedFile</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
</span><span id="__span-49-259"><a id="__codelineno-49-259" name="__codelineno-49-259" href="#__codelineno-49-259"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-49-260"><a id="__codelineno-49-260" name="__codelineno-49-260" href="#__codelineno-49-260"></a>
</span><span id="__span-49-261"><a id="__codelineno-49-261" name="__codelineno-49-261" href="#__codelineno-49-261"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-49-262"><a id="__codelineno-49-262" name="__codelineno-49-262" href="#__codelineno-49-262"></a><span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;App&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-263"><a id="__codelineno-49-263" name="__codelineno-49-263" href="#__codelineno-49-263"></a><span class="w">    </span><span class="o">&lt;</span><span class="nx">header</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;App-header&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-264"><a id="__codelineno-49-264" name="__codelineno-49-264" href="#__codelineno-49-264"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-265"><a id="__codelineno-49-265" name="__codelineno-49-265" href="#__codelineno-49-265"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">h1</span><span class="w"> </span><span class="o">&gt;</span><span class="nx">S3</span><span class="w"> </span><span class="nx">Management</span><span class="w"> </span><span class="nx">Tool</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span id="__span-49-266"><a id="__codelineno-49-266" name="__codelineno-49-266" href="#__codelineno-49-266"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-267"><a id="__codelineno-49-267" name="__codelineno-49-267" href="#__codelineno-49-267"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">User</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">userName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
</span><span id="__span-49-268"><a id="__codelineno-49-268" name="__codelineno-49-268" href="#__codelineno-49-268"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">logout</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Logout</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-269"><a id="__codelineno-49-269" name="__codelineno-49-269" href="#__codelineno-49-269"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-270"><a id="__codelineno-49-270" name="__codelineno-49-270" href="#__codelineno-49-270"></a><span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-271"><a id="__codelineno-49-271" name="__codelineno-49-271" href="#__codelineno-49-271"></a>
</span><span id="__span-49-272"><a id="__codelineno-49-272" name="__codelineno-49-272" href="#__codelineno-49-272"></a><span class="w">      </span><span class="p">{</span><span class="nx">showModal</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-49-273"><a id="__codelineno-49-273" name="__codelineno-49-273" href="#__codelineno-49-273"></a><span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;modal&quot;</span><span class="o">&gt;</span>
</span><span id="__span-49-274"><a id="__codelineno-49-274" name="__codelineno-49-274" href="#__codelineno-49-274"></a><span class="w">                </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;modal-content&quot;</span><span class="o">&gt;</span>
</span><span id="__span-49-275"><a id="__codelineno-49-275" name="__codelineno-49-275" href="#__codelineno-49-275"></a><span class="w">                  </span><span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Login</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
</span><span id="__span-49-276"><a id="__codelineno-49-276" name="__codelineno-49-276" href="#__codelineno-49-276"></a><span class="w">                  </span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Username</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span id="__span-49-277"><a id="__codelineno-49-277" name="__codelineno-49-277" href="#__codelineno-49-277"></a><span class="w">                  </span><span class="o">&lt;</span><span class="nx">input</span>
</span><span id="__span-49-278"><a id="__codelineno-49-278" name="__codelineno-49-278" href="#__codelineno-49-278"></a><span class="w">                    </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;login-input&quot;</span>
</span><span id="__span-49-279"><a id="__codelineno-49-279" name="__codelineno-49-279" href="#__codelineno-49-279"></a><span class="w">                    </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Username&quot;</span>
</span><span id="__span-49-280"><a id="__codelineno-49-280" name="__codelineno-49-280" href="#__codelineno-49-280"></a><span class="w">                    </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">}</span>
</span><span id="__span-49-281"><a id="__codelineno-49-281" name="__codelineno-49-281" href="#__codelineno-49-281"></a><span class="w">                    </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setUser</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
</span><span id="__span-49-282"><a id="__codelineno-49-282" name="__codelineno-49-282" href="#__codelineno-49-282"></a><span class="w">                    </span><span class="nx">required</span>
</span><span id="__span-49-283"><a id="__codelineno-49-283" name="__codelineno-49-283" href="#__codelineno-49-283"></a><span class="w">                        </span><span class="o">/&gt;</span>
</span><span id="__span-49-284"><a id="__codelineno-49-284" name="__codelineno-49-284" href="#__codelineno-49-284"></a><span class="w">                  </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;modal-buttons&quot;</span><span class="o">&gt;</span>
</span><span id="__span-49-285"><a id="__codelineno-49-285" name="__codelineno-49-285" href="#__codelineno-49-285"></a><span class="w">                    </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;buttons&quot;</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="nx">saveCredentials</span><span class="p">();</span><span class="nx">setShowModal</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="nx">refresh</span><span class="p">()}}</span><span class="o">&gt;</span><span class="nx">Login</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-286"><a id="__codelineno-49-286" name="__codelineno-49-286" href="#__codelineno-49-286"></a><span class="w">                  </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-287"><a id="__codelineno-49-287" name="__codelineno-49-287" href="#__codelineno-49-287"></a>
</span><span id="__span-49-288"><a id="__codelineno-49-288" name="__codelineno-49-288" href="#__codelineno-49-288"></a><span class="w">                </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-289"><a id="__codelineno-49-289" name="__codelineno-49-289" href="#__codelineno-49-289"></a><span class="w">              </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-290"><a id="__codelineno-49-290" name="__codelineno-49-290" href="#__codelineno-49-290"></a><span class="w">      </span><span class="p">)}</span>
</span><span id="__span-49-291"><a id="__codelineno-49-291" name="__codelineno-49-291" href="#__codelineno-49-291"></a>
</span><span id="__span-49-292"><a id="__codelineno-49-292" name="__codelineno-49-292" href="#__codelineno-49-292"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;blocks&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-293"><a id="__codelineno-49-293" name="__codelineno-49-293" href="#__codelineno-49-293"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;block&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-294"><a id="__codelineno-49-294" name="__codelineno-49-294" href="#__codelineno-49-294"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">h1</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="o">&gt;</span><span class="nx">Novo</span><span class="w"> </span><span class="nx">upload</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span id="__span-49-295"><a id="__codelineno-49-295" name="__codelineno-49-295" href="#__codelineno-49-295"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;buttons&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-296"><a id="__codelineno-49-296" name="__codelineno-49-296" href="#__codelineno-49-296"></a><span class="w">            </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">handleFileChange</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-49-297"><a id="__codelineno-49-297" name="__codelineno-49-297" href="#__codelineno-49-297"></a><span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleFileUpload</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Upload</span><span class="w"> </span><span class="nx">em</span><span class="w"> </span><span class="p">{</span><span class="nx">bucketName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-298"><a id="__codelineno-49-298" name="__codelineno-49-298" href="#__codelineno-49-298"></a><span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleFileUploadFotos</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Upload</span><span class="w"> </span><span class="nx">em</span><span class="w"> </span><span class="p">{</span><span class="nx">bucketfotosName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-299"><a id="__codelineno-49-299" name="__codelineno-49-299" href="#__codelineno-49-299"></a><span class="w">            </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleFileUploadWebsite</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Upload</span><span class="w"> </span><span class="nx">em</span><span class="w"> </span><span class="p">{</span><span class="nx">websiteName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-300"><a id="__codelineno-49-300" name="__codelineno-49-300" href="#__codelineno-49-300"></a><span class="w">          </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-301"><a id="__codelineno-49-301" name="__codelineno-49-301" href="#__codelineno-49-301"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-302"><a id="__codelineno-49-302" name="__codelineno-49-302" href="#__codelineno-49-302"></a>
</span><span id="__span-49-303"><a id="__codelineno-49-303" name="__codelineno-49-303" href="#__codelineno-49-303"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;block&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-304"><a id="__codelineno-49-304" name="__codelineno-49-304" href="#__codelineno-49-304"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">h1</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="o">&gt;</span><span class="nx">Objetos</span><span class="w"> </span><span class="nx">em</span><span class="w"> </span><span class="p">{</span><span class="nx">bucketName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span id="__span-49-305"><a id="__codelineno-49-305" name="__codelineno-49-305" href="#__codelineno-49-305"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;buttons&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-306"><a id="__codelineno-49-306" name="__codelineno-49-306" href="#__codelineno-49-306"></a><span class="w">            </span><span class="p">{</span><span class="nx">objects</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-49-307"><a id="__codelineno-49-307" name="__codelineno-49-307" href="#__codelineno-49-307"></a><span class="w">              </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span>
</span><span id="__span-49-308"><a id="__codelineno-49-308" name="__codelineno-49-308" href="#__codelineno-49-308"></a><span class="w">                </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()=&gt;</span><span class="nx">handleFileDownload</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">Key</span><span class="p">)}</span><span class="w"> </span><span class="o">&gt;</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">Key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mf">1</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-309"><a id="__codelineno-49-309" name="__codelineno-49-309" href="#__codelineno-49-309"></a><span class="w">              </span><span class="o">&lt;</span><span class="err">/div&gt;))</span>
</span><span id="__span-49-310"><a id="__codelineno-49-310" name="__codelineno-49-310" href="#__codelineno-49-310"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-49-311"><a id="__codelineno-49-311" name="__codelineno-49-311" href="#__codelineno-49-311"></a><span class="w">          </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-312"><a id="__codelineno-49-312" name="__codelineno-49-312" href="#__codelineno-49-312"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-313"><a id="__codelineno-49-313" name="__codelineno-49-313" href="#__codelineno-49-313"></a><span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-314"><a id="__codelineno-49-314" name="__codelineno-49-314" href="#__codelineno-49-314"></a>
</span><span id="__span-49-315"><a id="__codelineno-49-315" name="__codelineno-49-315" href="#__codelineno-49-315"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;blocks&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-316"><a id="__codelineno-49-316" name="__codelineno-49-316" href="#__codelineno-49-316"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;block&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-317"><a id="__codelineno-49-317" name="__codelineno-49-317" href="#__codelineno-49-317"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">h1</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="o">&gt;</span><span class="nx">Objetos</span><span class="w"> </span><span class="nx">em</span><span class="w"> </span><span class="p">{</span><span class="nx">bucketfotosName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span id="__span-49-318"><a id="__codelineno-49-318" name="__codelineno-49-318" href="#__codelineno-49-318"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;buttons&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-319"><a id="__codelineno-49-319" name="__codelineno-49-319" href="#__codelineno-49-319"></a><span class="w">            </span><span class="p">{</span><span class="nx">fotos</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-49-320"><a id="__codelineno-49-320" name="__codelineno-49-320" href="#__codelineno-49-320"></a><span class="w">              </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span>
</span><span id="__span-49-321"><a id="__codelineno-49-321" name="__codelineno-49-321" href="#__codelineno-49-321"></a><span class="w">                </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()=&gt;</span><span class="nx">handleFileDownloadFotos</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">Key</span><span class="p">)}</span><span class="w"> </span><span class="o">&gt;</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">Key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mf">1</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-322"><a id="__codelineno-49-322" name="__codelineno-49-322" href="#__codelineno-49-322"></a><span class="w">              </span><span class="o">&lt;</span><span class="err">/div&gt;))</span>
</span><span id="__span-49-323"><a id="__codelineno-49-323" name="__codelineno-49-323" href="#__codelineno-49-323"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-49-324"><a id="__codelineno-49-324" name="__codelineno-49-324" href="#__codelineno-49-324"></a><span class="w">          </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-325"><a id="__codelineno-49-325" name="__codelineno-49-325" href="#__codelineno-49-325"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-326"><a id="__codelineno-49-326" name="__codelineno-49-326" href="#__codelineno-49-326"></a>
</span><span id="__span-49-327"><a id="__codelineno-49-327" name="__codelineno-49-327" href="#__codelineno-49-327"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;block&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-328"><a id="__codelineno-49-328" name="__codelineno-49-328" href="#__codelineno-49-328"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">h1</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;font&#39;</span><span class="o">&gt;</span><span class="nx">Objetos</span><span class="w"> </span><span class="nx">em</span><span class="w"> </span><span class="p">{</span><span class="nx">websiteName</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span id="__span-49-329"><a id="__codelineno-49-329" name="__codelineno-49-329" href="#__codelineno-49-329"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s1">&#39;buttons&#39;</span><span class="o">&gt;</span>
</span><span id="__span-49-330"><a id="__codelineno-49-330" name="__codelineno-49-330" href="#__codelineno-49-330"></a><span class="w">            </span><span class="p">{</span><span class="nx">siteObjetcs</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-49-331"><a id="__codelineno-49-331" name="__codelineno-49-331" href="#__codelineno-49-331"></a><span class="w">              </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span>
</span><span id="__span-49-332"><a id="__codelineno-49-332" name="__codelineno-49-332" href="#__codelineno-49-332"></a><span class="w">                </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()=&gt;</span><span class="nx">handleFileDownloadWebsite</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">Key</span><span class="p">)}</span><span class="w"> </span><span class="o">&gt;</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">Key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mf">1</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-49-333"><a id="__codelineno-49-333" name="__codelineno-49-333" href="#__codelineno-49-333"></a><span class="w">              </span><span class="o">&lt;</span><span class="err">/div&gt;))</span>
</span><span id="__span-49-334"><a id="__codelineno-49-334" name="__codelineno-49-334" href="#__codelineno-49-334"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-49-335"><a id="__codelineno-49-335" name="__codelineno-49-335" href="#__codelineno-49-335"></a><span class="w">          </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-336"><a id="__codelineno-49-336" name="__codelineno-49-336" href="#__codelineno-49-336"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-337"><a id="__codelineno-49-337" name="__codelineno-49-337" href="#__codelineno-49-337"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-338"><a id="__codelineno-49-338" name="__codelineno-49-338" href="#__codelineno-49-338"></a>
</span><span id="__span-49-339"><a id="__codelineno-49-339" name="__codelineno-49-339" href="#__codelineno-49-339"></a><span class="w">    </span><span class="o">&lt;</span><span class="err">/header&gt;</span>
</span><span id="__span-49-340"><a id="__codelineno-49-340" name="__codelineno-49-340" href="#__codelineno-49-340"></a><span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-49-341"><a id="__codelineno-49-341" name="__codelineno-49-341" href="#__codelineno-49-341"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-49-342"><a id="__codelineno-49-342" name="__codelineno-49-342" href="#__codelineno-49-342"></a><span class="p">};</span>
</span><span id="__span-49-343"><a id="__codelineno-49-343" name="__codelineno-49-343" href="#__codelineno-49-343"></a>
</span><span id="__span-49-344"><a id="__codelineno-49-344" name="__codelineno-49-344" href="#__codelineno-49-344"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</span></code></pre></div>
</details>
<p>Coloque também a estilização do site:</p>
<details class="app_css">
<summary>App_css</summary>
<div class="language-css highlight"><span class="filename">App.css</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="w">      </span><span class="p">.</span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">  </span><span class="p">.</span><span class="nc">App-logo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">vmin</span><span class="p">;</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">    </span><span class="k">pointer-events</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">  </span><span class="p">.</span><span class="nc">bar</span><span class="p">{</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">    </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">row</span><span class="p">;</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">    </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">    </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">    </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="w"> </span><span class="mi">124</span><span class="p">);</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">  </span><span class="p">.</span><span class="nc">log</span><span class="p">{</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">    </span><span class="k">right</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">    </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">    </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="w">    </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="w">  </span><span class="p">.</span><span class="nc">blocks</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a><span class="w">    </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">row</span><span class="p">;</span>
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a><span class="w">  </span><span class="p">.</span><span class="nc">block</span><span class="p">{</span>
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="w"> </span><span class="nb">linear-gradient</span><span class="p">(</span><span class="nb">rgb</span><span class="p">(</span><span class="mi">244</span><span class="p">,</span><span class="w"> </span><span class="mi">138</span><span class="p">,</span><span class="w"> </span><span class="mi">138</span><span class="p">),</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">193</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">));</span>
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a><span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a><span class="w">    </span><span class="k">min-width</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a><span class="w">    </span><span class="k">min-height</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a><span class="w">  </span><span class="p">@</span><span class="k">media</span><span class="w"> </span><span class="o">(</span><span class="nt">prefers-reduced-motion</span><span class="o">:</span><span class="w"> </span><span class="nt">no-preference</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a><span class="w">    </span><span class="p">.</span><span class="nc">App-logo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a><span class="w">      </span><span class="k">animation</span><span class="p">:</span><span class="w"> </span><span class="n">App-logo-spin</span><span class="w"> </span><span class="kc">infinite</span><span class="w"> </span><span class="mi">20</span><span class="kt">s</span><span class="w"> </span><span class="kc">linear</span><span class="p">;</span>
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a>
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a><span class="w">  </span><span class="p">.</span><span class="nc">App-header</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50" href="#__codelineno-50-50"></a><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51" href="#__codelineno-50-51"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52" href="#__codelineno-50-52"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="w"> </span><span class="nb">linear-gradient</span><span class="p">(</span><span class="nb">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">244</span><span class="p">,</span><span class="w"> </span><span class="mi">83</span><span class="p">,</span><span class="w"> </span><span class="mi">89</span><span class="p">));</span>
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53" href="#__codelineno-50-53"></a><span class="w">    </span><span class="k">min-height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54" href="#__codelineno-50-54"></a><span class="w">    </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55" href="#__codelineno-50-55"></a><span class="w">    </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-56"><a id="__codelineno-50-56" name="__codelineno-50-56" href="#__codelineno-50-56"></a><span class="w">    </span><span class="c">/* justify-content: space-between; */</span>
</span><span id="__span-50-57"><a id="__codelineno-50-57" name="__codelineno-50-57" href="#__codelineno-50-57"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="nb">calc</span><span class="p">(</span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="kt">vmin</span><span class="p">);</span>
</span><span id="__span-50-58"><a id="__codelineno-50-58" name="__codelineno-50-58" href="#__codelineno-50-58"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
</span><span id="__span-50-59"><a id="__codelineno-50-59" name="__codelineno-50-59" href="#__codelineno-50-59"></a><span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-50-60"><a id="__codelineno-50-60" name="__codelineno-50-60" href="#__codelineno-50-60"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-50-61"><a id="__codelineno-50-61" name="__codelineno-50-61" href="#__codelineno-50-61"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-62"><a id="__codelineno-50-62" name="__codelineno-50-62" href="#__codelineno-50-62"></a>
</span><span id="__span-50-63"><a id="__codelineno-50-63" name="__codelineno-50-63" href="#__codelineno-50-63"></a><span class="w">  </span><span class="p">.</span><span class="nc">App-link</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-64"><a id="__codelineno-50-64" name="__codelineno-50-64" href="#__codelineno-50-64"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#61dafb</span><span class="p">;</span>
</span><span id="__span-50-65"><a id="__codelineno-50-65" name="__codelineno-50-65" href="#__codelineno-50-65"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-66"><a id="__codelineno-50-66" name="__codelineno-50-66" href="#__codelineno-50-66"></a>
</span><span id="__span-50-67"><a id="__codelineno-50-67" name="__codelineno-50-67" href="#__codelineno-50-67"></a><span class="w">  </span><span class="p">@</span><span class="k">keyframes</span><span class="w"> </span><span class="nt">App-logo-spin</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-68"><a id="__codelineno-50-68" name="__codelineno-50-68" href="#__codelineno-50-68"></a><span class="w">    </span><span class="nt">from</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-69"><a id="__codelineno-50-69" name="__codelineno-50-69" href="#__codelineno-50-69"></a><span class="w">      </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">rotate</span><span class="p">(</span><span class="mi">0</span><span class="kt">deg</span><span class="p">);</span>
</span><span id="__span-50-70"><a id="__codelineno-50-70" name="__codelineno-50-70" href="#__codelineno-50-70"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-71"><a id="__codelineno-50-71" name="__codelineno-50-71" href="#__codelineno-50-71"></a><span class="w">    </span><span class="nt">to</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-72"><a id="__codelineno-50-72" name="__codelineno-50-72" href="#__codelineno-50-72"></a><span class="w">      </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">rotate</span><span class="p">(</span><span class="mi">360</span><span class="kt">deg</span><span class="p">);</span>
</span><span id="__span-50-73"><a id="__codelineno-50-73" name="__codelineno-50-73" href="#__codelineno-50-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-74"><a id="__codelineno-50-74" name="__codelineno-50-74" href="#__codelineno-50-74"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-75"><a id="__codelineno-50-75" name="__codelineno-50-75" href="#__codelineno-50-75"></a>
</span><span id="__span-50-76"><a id="__codelineno-50-76" name="__codelineno-50-76" href="#__codelineno-50-76"></a><span class="w">  </span><span class="p">.</span><span class="nc">modal</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-77"><a id="__codelineno-50-77" name="__codelineno-50-77" href="#__codelineno-50-77"></a><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">fixed</span><span class="p">;</span>
</span><span id="__span-50-78"><a id="__codelineno-50-78" name="__codelineno-50-78" href="#__codelineno-50-78"></a><span class="w">    </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span><span id="__span-50-79"><a id="__codelineno-50-79" name="__codelineno-50-79" href="#__codelineno-50-79"></a><span class="w">    </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-50-80"><a id="__codelineno-50-80" name="__codelineno-50-80" href="#__codelineno-50-80"></a><span class="w">    </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-50-81"><a id="__codelineno-50-81" name="__codelineno-50-81" href="#__codelineno-50-81"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-50-82"><a id="__codelineno-50-82" name="__codelineno-50-82" href="#__codelineno-50-82"></a><span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-50-83"><a id="__codelineno-50-83" name="__codelineno-50-83" href="#__codelineno-50-83"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-50-84"><a id="__codelineno-50-84" name="__codelineno-50-84" href="#__codelineno-50-84"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-85"><a id="__codelineno-50-85" name="__codelineno-50-85" href="#__codelineno-50-85"></a><span class="w">    </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-86"><a id="__codelineno-50-86" name="__codelineno-50-86" href="#__codelineno-50-86"></a><span class="w">    </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-87"><a id="__codelineno-50-87" name="__codelineno-50-87" href="#__codelineno-50-87"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-88"><a id="__codelineno-50-88" name="__codelineno-50-88" href="#__codelineno-50-88"></a>
</span><span id="__span-50-89"><a id="__codelineno-50-89" name="__codelineno-50-89" href="#__codelineno-50-89"></a><span class="w">  </span><span class="p">.</span><span class="nc">modal-content</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-90"><a id="__codelineno-50-90" name="__codelineno-50-90" href="#__codelineno-50-90"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-91"><a id="__codelineno-50-91" name="__codelineno-50-91" href="#__codelineno-50-91"></a><span class="w">    </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
</span><span id="__span-50-92"><a id="__codelineno-50-92" name="__codelineno-50-92" href="#__codelineno-50-92"></a><span class="w">    </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-93"><a id="__codelineno-50-93" name="__codelineno-50-93" href="#__codelineno-50-93"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="w"> </span><span class="nb">linear-gradient</span><span class="p">(</span><span class="nb">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mi">77</span><span class="p">),</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-50-94"><a id="__codelineno-50-94" name="__codelineno-50-94" href="#__codelineno-50-94"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-95"><a id="__codelineno-50-95" name="__codelineno-50-95" href="#__codelineno-50-95"></a><span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-96"><a id="__codelineno-50-96" name="__codelineno-50-96" href="#__codelineno-50-96"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-97"><a id="__codelineno-50-97" name="__codelineno-50-97" href="#__codelineno-50-97"></a>
</span><span id="__span-50-98"><a id="__codelineno-50-98" name="__codelineno-50-98" href="#__codelineno-50-98"></a><span class="w">  </span><span class="p">.</span><span class="nc">modal-content</span><span class="w"> </span><span class="nt">h2</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-99"><a id="__codelineno-50-99" name="__codelineno-50-99" href="#__codelineno-50-99"></a><span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-50-100"><a id="__codelineno-50-100" name="__codelineno-50-100" href="#__codelineno-50-100"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-101"><a id="__codelineno-50-101" name="__codelineno-50-101" href="#__codelineno-50-101"></a>
</span><span id="__span-50-102"><a id="__codelineno-50-102" name="__codelineno-50-102" href="#__codelineno-50-102"></a><span class="w">  </span><span class="p">.</span><span class="nc">modal-buttons</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-103"><a id="__codelineno-50-103" name="__codelineno-50-103" href="#__codelineno-50-103"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-104"><a id="__codelineno-50-104" name="__codelineno-50-104" href="#__codelineno-50-104"></a><span class="w">    </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-50-105"><a id="__codelineno-50-105" name="__codelineno-50-105" href="#__codelineno-50-105"></a><span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-106"><a id="__codelineno-50-106" name="__codelineno-50-106" href="#__codelineno-50-106"></a><span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-50-107"><a id="__codelineno-50-107" name="__codelineno-50-107" href="#__codelineno-50-107"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-108"><a id="__codelineno-50-108" name="__codelineno-50-108" href="#__codelineno-50-108"></a>
</span><span id="__span-50-109"><a id="__codelineno-50-109" name="__codelineno-50-109" href="#__codelineno-50-109"></a><span class="w">  </span><span class="p">.</span><span class="nc">modal-buttons</span><span class="w"> </span><span class="nt">button</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-110"><a id="__codelineno-50-110" name="__codelineno-50-110" href="#__codelineno-50-110"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-111"><a id="__codelineno-50-111" name="__codelineno-50-111" href="#__codelineno-50-111"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-50-112"><a id="__codelineno-50-112" name="__codelineno-50-112" href="#__codelineno-50-112"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-50-113"><a id="__codelineno-50-113" name="__codelineno-50-113" href="#__codelineno-50-113"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="w"> </span><span class="nb">linear-gradient</span><span class="p">(</span><span class="nb">rgb</span><span class="p">(</span><span class="mi">252</span><span class="p">,</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="w"> </span><span class="mi">102</span><span class="p">),</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">249</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">));</span>
</span><span id="__span-50-114"><a id="__codelineno-50-114" name="__codelineno-50-114" href="#__codelineno-50-114"></a><span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-50-115"><a id="__codelineno-50-115" name="__codelineno-50-115" href="#__codelineno-50-115"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-50-116"><a id="__codelineno-50-116" name="__codelineno-50-116" href="#__codelineno-50-116"></a><span class="w">    </span><span class="k">outline</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-50-117"><a id="__codelineno-50-117" name="__codelineno-50-117" href="#__codelineno-50-117"></a><span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-50-118"><a id="__codelineno-50-118" name="__codelineno-50-118" href="#__codelineno-50-118"></a><span class="w">    </span><span class="k">transition-duration</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4</span><span class="kt">s</span><span class="p">;</span>
</span><span id="__span-50-119"><a id="__codelineno-50-119" name="__codelineno-50-119" href="#__codelineno-50-119"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-120"><a id="__codelineno-50-120" name="__codelineno-50-120" href="#__codelineno-50-120"></a>
</span><span id="__span-50-121"><a id="__codelineno-50-121" name="__codelineno-50-121" href="#__codelineno-50-121"></a><span class="w">  </span><span class="p">.</span><span class="nc">modal-buttons</span><span class="w"> </span><span class="nt">button</span><span class="p">:</span><span class="nd">hover</span><span class="p">{</span>
</span><span id="__span-50-122"><a id="__codelineno-50-122" name="__codelineno-50-122" href="#__codelineno-50-122"></a><span class="w">    </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">scale</span><span class="p">(</span><span class="mf">1.03</span><span class="p">);</span>
</span><span id="__span-50-123"><a id="__codelineno-50-123" name="__codelineno-50-123" href="#__codelineno-50-123"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="nb">rgb</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">88</span><span class="p">,</span><span class="w"> </span><span class="mi">227</span><span class="p">);</span>
</span><span id="__span-50-124"><a id="__codelineno-50-124" name="__codelineno-50-124" href="#__codelineno-50-124"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-125"><a id="__codelineno-50-125" name="__codelineno-50-125" href="#__codelineno-50-125"></a>
</span><span id="__span-50-126"><a id="__codelineno-50-126" name="__codelineno-50-126" href="#__codelineno-50-126"></a><span class="w">  </span><span class="p">.</span><span class="nc">buttons</span><span class="p">{</span>
</span><span id="__span-50-127"><a id="__codelineno-50-127" name="__codelineno-50-127" href="#__codelineno-50-127"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
</span><span id="__span-50-128"><a id="__codelineno-50-128" name="__codelineno-50-128" href="#__codelineno-50-128"></a><span class="w">    </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
</span><span id="__span-50-129"><a id="__codelineno-50-129" name="__codelineno-50-129" href="#__codelineno-50-129"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-130"><a id="__codelineno-50-130" name="__codelineno-50-130" href="#__codelineno-50-130"></a>
</span><span id="__span-50-131"><a id="__codelineno-50-131" name="__codelineno-50-131" href="#__codelineno-50-131"></a><span class="w">  </span><span class="p">.</span><span class="nc">font</span><span class="p">{</span>
</span><span id="__span-50-132"><a id="__codelineno-50-132" name="__codelineno-50-132" href="#__codelineno-50-132"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-50-133"><a id="__codelineno-50-133" name="__codelineno-50-133" href="#__codelineno-50-133"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
</details>
<p>Com arquivos locais configurados, execute na pasta <strong>interface/</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>npm<span class="w"> </span>start
</span></code></pre></div>
<p>Após carregamento, na porta 3000, você deverá ver a interface, onde você pode colocar o seu nome de usuário que poderá interagir e ter suas permissões no Bucket:</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface1.png"/>
</div>

<p>Após logar como "nivea", você verá que a interface lista os objetos em cada um dos três buckets pertecentes ao usuário logado (por enquanto nenhum) e dá a opção de upload de arquivos em cada um dos buckets:</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface2.png"/>
</div>

<p>Ao se realizar o upload de um arquivo para o bucket padrão e o bucket de fotos, podemos ver que eles já aparecem disponíveis na interface:</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface3.png"/>
</div>

<p>Ao clicar nos arquivos dentro dos buckets, é realizado o download destes:</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface7.png"/>
</div>

<p>Caso deslogarmos, e entrarmos em um novo usuário chamado "rodolfo", podemos ver que os arquivos pertencentes ao usuário "nivea" não são mostrados a ele (gerenciado permissões via interface):</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface8.png"/>
</div>

<p>Analogamente, quando este realiza upload de seus arquivos, apenas seus arquivos são mostrados nos buckets:</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface4.png"/>
</div>

<p>Na dashboard da AWS, podemos ver que há uma nítida divisão entre as pastas para cada usuário, e, a cada novo usuário cadastrado, uma nova pasta (Prefix) será criada, gerando assim uma noção de permissões diferentes para cada usuário à nivel de aplicação:</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface5.png"/>
</div>

<p>Por fim, podes averiguar que o email cadastrado no tópico também é notificado quando um novo objeto é inserido:</p>
<div align="center">
  <img  style="width:500px" src="./assets/interface6.png"/>
</div>

<p>E dessa forma, encerramos nossa arquitetura e projeto. Conforme podem ver pelas figuras acima, a aplicação é de cunho de prova de conceito e deve ser utilizada apenas com  intuito de entendimento de recursos em Cloud e não em ambientes de produção.</p>
<p>Agradeço a todos que leram este roteiro até o final, em especial os professores da disciplina, Rodolfo Avelino e Tiago Demay.</p>
<h2 id="referencias">Referências</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/pt_br/AmazonS3/latest/userguide/Welcome.html">Documentação S3</a></li>
<li><a href="https://registry.terraform.io/">Documentação Terraform</a></li>
<li><a href="https://docs.aws.amazon.com/pt_br/AmazonS3/latest/userguide/NotificationHowTo.html">Documentação SNS</a></li>
<li><a href="https://docs.aws.amazon.com/pt_br/cloudwatch/?icmpid=docs_homepage_mgmtgov">Documentação Cloudwatch</a></li>
<li><a href="https://docs.aws.amazon.com/pt_br/lambda/">Documentação Lambda</a></li>
</ul>
<div align="center">
  <img  style="width:500px" src="./assets/tutorial.gif"/>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy"], "search": "assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>